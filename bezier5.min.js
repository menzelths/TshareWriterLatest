var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(v,C,r){v!=Array.prototype&&v!=Object.prototype&&(v[C]=r.value)};$jscomp.getGlobal=function(v){return"undefined"!=typeof window&&window===v?v:"undefined"!=typeof global&&null!=global?global:v};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(v,C,r,D){if(C){r=$jscomp.global;v=v.split(".");for(D=0;D<v.length-1;D++){var A=v[D];A in r||(r[A]={});r=r[A]}v=v[v.length-1];D=r[v];C=C(D);C!=D&&null!=C&&$jscomp.defineProperty(r,v,{configurable:!0,writable:!0,value:C})}};$jscomp.polyfill("Array.prototype.fill",function(v){return v?v:function(v,r,D){var A=this.length||0;0>r&&(r=Math.max(0,A+r));if(null==D||D>A)D=A;D=Number(D);0>D&&(D=Math.max(0,A+D));for(r=Number(r||0);r<D;r++)this[r]=v;return this}},"es6-impl","es3");
$jscomp.findInternal=function(v,C,r){v instanceof String&&(v=String(v));for(var D=v.length,A=0;A<D;A++){var U=v[A];if(C.call(r,U,A,v))return{i:A,v:U}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(v){return v?v:function(v,r){return $jscomp.findInternal(this,v,r).v}},"es6-impl","es3");
(function(){function v(r,D,A,U,J){for(var w=U,k,C=D+1;C<A;C++){var E=r[C];var F=r[D],ca=r[A],R=F.x,F=F.y,O=ca.x-R,S=ca.y-F;if(0!==O||0!==S){var V=((E.x-R)*O+(E.y-F)*S)/(O*O+S*S);1<V?(R=ca.x,F=ca.y):0<V&&(R+=O*V,F+=S*V)}O=E.x-R;S=E.y-F;E=O*O+S*S;E>w&&(k=C,w=E)}w>U&&(1<k-D&&v(r,D,k,U,J),J.push(r[k]),1<A-k&&v(r,k,A,U,J))}function C(r,D,A){if(2>=r.length)return r;D=void 0!==D?D*D:1;if(A)var C=r;else{A=r[0];for(var J=[A],w=1,k=r.length;w<k;w++){C=r[w];var T=C.x-A.x,E=C.y-A.y;T*T+E*E>D&&(J.push(C),A=C)}A!==
C&&J.push(C);C=J}r=C.length-1;A=[C[0]];v(C,0,r,D,A);A.push(C[r]);return A}"function"===typeof define&&define.amd?define(function(){return C}):"undefined"!==typeof module?module.exports=C:"undefined"!==typeof self?self.simplify=C:window.simplify=C})();
var QreatorBezier=new function(){function v(){if(0==Y){$(".layer").removeClass("aktivBunt");$("#dicken option").prop("selected",!1).filter("[dicke='"+K+"']").prop("selected",!0);$(".layer").each(function(){$(this).removeClass("sichtbar")});$(".layer").each(function(){$(this).removeClass("unsichtbar")});$(".layer").removeClass("aktivLayer");for(var b=0;b<l.length;b++)1==H[b]?$("[layer='"+l[b]+"']").addClass("sichtbar"):$("[layer='"+l[b]+"']").addClass("unsichtbar");$(".layer").removeAttr("style");
$(".layer").each(function(a){1==da&&1==H[a]&&($(this).attr("style","background-color: "+ga[a]+";"),a==k&&$(this).addClass("aktivBunt"))});1==H[k]&&$("[layer='"+l[k]+"']").addClass("aktivLayer");$("#radierer").removeClass("aktiv");$("#stift").addClass("aktiv")}else{$(".layer").removeClass("aktivBunt");$("#dicken option").prop("selected",!1).filter("[dicke='"+K+"']").prop("selected",!0);$(".layer").each(function(){$(this).removeClass("sichtbar")});$(".layer").each(function(){$(this).removeClass("unsichtbar")});
for(b=0;b<l.length;b++)1==H[b]?$("[layer='"+l[b]+"']").addClass("sichtbar"):$("[layer='"+l[b]+"']").addClass("unsichtbar");$(".layer").removeAttr("style");$(".layer").each(function(a){1==da&&1==H[a]&&($(this).attr("style","background-color: "+ga[a]+";"),a==k&&$(this).addClass("aktivBunt"))});$(".layer").removeClass("aktivLayer");1==H[k]&&$("[layer='"+l[k]+"']").addClass("aktivLayer");$("#radierer").addClass("aktiv");$("#stift").removeClass("aktiv")}var b=document.createElement("canvas"),a=K*window.devicePixelRatio;
b.width=a+3;b.height=a+3;var d=b.getContext("2d");d.beginPath();a=parseInt(a/2);0==a&&(a=1);d.arc(a+1,a+1,a,0,2*Math.PI);0==Y?(d.fillStyle=W,d.strokeStyle=W):(d.strokeStyle="rgba(255,200,200,1)",d.fillStyle="rgba(255,200,200,1)");d.stroke();d.fill();b="url("+b.toDataURL()+")"+(a-2)+" "+(a-2)+",auto";$("#layer3").css("cursor",b)}function C(b,a){b<=oa&&$("#ausgabe").append(a+"<br>")}function r(b,a){m=1;for(var d=0;d<a;d++)m*=10;return parseInt(b*m,10)/m}function D(b,a){return!(b[0]>a[2]||b[2]<a[0]||
b[1]>a[3]||b[3]<a[1])}function A(b){if(1==H[k]){if(!0===ma){var a=b.pageX-T.offsetLeft-$("#rahmen")[0].offsetLeft;b=b.pageY-T.offsetTop-$("#rahmen")[0].offsetTop;if(0===aa.length){I.beginPath();I.moveTo(a,b);ia=a;ha=b;ja=[];I.lineWidth=""+K;I.strokeStyle=W;I.lineCap="round";for(var d=0;d<R*O;d++)ja[d]=0}else{I.lineTo(a,b);if(1===Y){I.lineWidth=""+K;I.strokeStyle="rgba(255,200,200,1)";var d=a;ia<a&&(d=ia);var f=b,c=ha;ha<b&&(f=ha,c=b);d-=K;var e=d+K;f-=K;c+=K;d=parseInt(d/(1*E/R),10);e=parseInt(e/
(1*E/R),10);f=parseInt(f/(1*F/O),10);for(c=parseInt(c/(1*F/O),10);d<=e;d++)for(var h=f;h<=c;h++)ja[h*R+d]=1;ia=a;ha=b}I.stroke();I.beginPath();I.moveTo(a,b)}aa.push(new w(a,b))}if(!0===ea&&!0===ea){rechtecke2=[];for(a=0;a<R*O;a++)1===ja[a]&&rechtecke2.push(a);pa=B.findeRechtecksHuelle(aa);if(0===Y){var a=aa;1===a.length&&(e=a[0].x,b=a[0].y,a=[],a.push(new w(e-1,b-1)),a.push(new w(e+1,b-1)),a.push(new w(e+1,b+1)),a.push(new w(e-1,b+1)));b=!1;c=e=a[0].x;f=d=a[0].y;for(h=1;h<a.length;h++){var g=a[h];
g.x>c?c=g.x:g.x<e&&(e=g.x);g.y>f?f=g.y:g.y<d&&(d=g.y)}c=[e,d,c,f];d=parseInt(Math.max(c[2]-c[0],c[3]-c[1])/5,10);e=B.berechneEntfernung(a[0],a[a.length-1]);if(e<d){f=c[0];h=c[2];g=c[1];var n=c[3],d=1*(h-f)/(n-g);if(1.5>d&&.8<d){d=.25*(h-f+(n-g));f=new w(.5*(f+h),.5*(g+n));h=!0;for(c=0;c<a.length;c++)g=B.berechneEntfernung(f,a[c]),g<1.3*d&&g>.8*d||(h=!1,c=a.length);!0===h&&(erg=[],erg.push([new w(f.x,f.y+d),new w(f.x+.551915024494*d,f.y+d),new w(f.x+d,f.y+.551915024494*d),new w(f.x+d,f.y)]),erg.push([new w(f.x+
d,f.y),new w(f.x+d,f.y-.551915024494*d),new w(f.x+.551915024494*d,f.y-d),new w(f.x,f.y-d)]),erg.push([new w(f.x,f.y-d),new w(f.x-.551915024494*d,f.y-d),new w(f.x-d,f.y-.551915024494*d),new w(f.x-d,f.y)]),erg.push([new w(f.x-d,f.y),new w(f.x-d,f.y+.551915024494*d),new w(f.x-.551915024494*d,f.y+d),new w(f.x,f.y+d)]),b=!0)}else{d=parseInt(Math.max(c[2]-c[0],c[3]-c[1])/20,10);20<d&&(d=20);f=[];for(c=0;c<a.length;c++)f.push(new w(a[c].x,a[c].y));f=window.simplify(f,d,!0);erg=[];if(3<f.length&&6>f.length){f[f.length-
1]=f[0];if(5==f.length)for(c=0;c<f.length-1;c++)g=f[c],h=f[c+1],d=h.x-g.x,b=h.y-g.y,0!==b&&(h=1*b/d,.3>Math.abs(h)&&(3==c?(f[c+1].y=f[0].y,f[c].y=f[c+1].y):f[c+1].y=f[c].y)),0!==d&&(h=1*d/b,.3>Math.abs(h)&&(3==c?(f[c+1].x=f[0].x,f[c].x=f[c+1].x):f[c+1].x=f[c].x));for(c=0;c<f.length-1;c++)g=new w(f[c].x,f[c].y),h=new w(f[c+1].x,f[c+1].y),erg.push([g,B.addiere(g,B.multipliziereMitSkalar(B.subtrahiere(h,g),1/3)),B.addiere(g,B.multipliziereMitSkalar(B.subtrahiere(h,g),2/3)),h]);b=!0}}}if(!1===b){d=parseInt(e/
20,10);erg=[];e=a;c=d;d=0;f=!0;for(h=1;h<e.length-1;h++){g=e[h];var n=e[0],u=e[e.length-1];if(n.x===u.x)g=Math.abs(g.x-n.x);else{var L=new w(u.x-n.x,u.y-n.y),t=new w(g.x-n.x,g.y-n.y);var q=Math.sqrt(L.x*L.x+L.y*L.y);t=(t.x*L.x+t.y*L.y)/q;t>q?(n=new w(u.x-g.x,u.y-g.y),g=Math.sqrt(n.x*n.x+n.y*n.y)):0>t?(n=new w(g.x-n.x,g.y-n.y),g=Math.sqrt(n.x*n.x+n.y*n.y)):(n=new w(n.x+t*L.x/q,n.y+t*L.y/q),g=new w(n.x-g.x,n.y-g.y),g=Math.sqrt(g.x*g.x+g.y*g.y))}g>d&&(d=g,d>c&&(f=!1,h=e.length))}!0===f&&(g=a[0],h=a[a.length-
1],d=h.x-g.x,b=h.y-g.y,0!==b&&Math.abs(1*b/d)<ca&&(e=(g.y+h.y)/2,g.y=e,h.y=e),0!==d&&Math.abs(1*d/b)<ca&&(e=(g.x+h.x)/2,g.x=e,h.x=e),erg=[[g,B.addiere(g,B.multipliziereMitSkalar(B.subtrahiere(h,g),1/3)),B.addiere(g,B.multipliziereMitSkalar(B.subtrahiere(h,g),2/3)),h]],b=!0)}B.initialisiere(a,ta);d=B.approximiere();if(0<a.length){e=I.createImageData(E,F);for(c=0;c<e.length;c+=4)e[c]=255,e[c+1]=255,e[c+2]=255,e[c+3]=0;I.putImageData(e,0,0)}f=z[l[k]].length;for(c=0;c<d.length;c++)e=d[c],1===e.length?
0==b&&(G.beginPath(),G.fillStyle=W,G.fillRect(e[0].x,e[0].y,1,1)):4===e.length&&(0==b&&(G.beginPath(),G.moveTo(e[0].x,e[0].y),G.strokeStyle=W,G.lineCap="round",G.lineWidth=""+K,G.bezierCurveTo(e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y),C(3,e[0].x+"/"+e[0].y+","+e[1].x+"/"+e[1].y+","+e[2].x+"/"+e[2].y+","+e[3].x+"/"+e[3].y),G.stroke()),z[l[k]].push([e,B.findeRechtecksHuelle(e),0,K,W]),p[l[k]].push(z[l[k]].length),Z=!1);0==Z&&U();X[N]=[[l[k],f+1,z[l[k]].length]];N++;d=z[l[k]].length;if(1==b){for(c=
0;c<erg.length;c++)e=erg[c],1===e.length?(G.beginPath(),G.fillStyle=W,G.fillRect(e[0].x,e[0].y,1,1)):4===e.length&&(G.beginPath(),G.moveTo(e[0].x,e[0].y),G.strokeStyle=W,G.lineCap="round",G.lineWidth=""+K,G.bezierCurveTo(e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y),C(3,e[0].x+"/"+e[0].y+","+e[1].x+"/"+e[1].y+","+e[2].x+"/"+e[2].y+","+e[3].x+"/"+e[3].y),G.stroke(),z[l[k]].push([e,B.findeRechtecksHuelle(e),0,K,W]),p[l[k]].push(z[l[k]].length),Z=!1);for(c=0;c<p[l[k]].length;c++)Math.abs(p[l[k]][c])>=Math.abs(f+
1)&&Math.abs(p[l[k]][c])<=Math.abs(d)&&(p[l[k]][c]=-p[l[k]][c]);X[N]=[[l[k],f+1,d],[l[k],d+1,z[l[k]].length]];N++}if(2<oa)for(c=0;c<a.length;c++)e=a[c].x,b=a[c].y,I.fillStyle="#ff0000",I.fillRect(e-2,b-2,5,5);aa=[];ea=!1}else if(1===Y){b=[];for(a=0;a<l.length;a++)b[a]=0,a==l[k]&&(b[a]=1);e=[];for(c=0;c<b.length;c++)if(0<b[c])if(null!=z[c]&&0<z[c].length){P=[];if(rechtecke2.length<ua)for(a=0;a<p[c].length;a++)0<p[c][a]&&(d=z[c][p[c][a]-1][1],!0===D(pa,d)&&P.push(a));else for(a=0;a<p[c].length;a++)if(0<
p[c][a]){d=z[c][p[c][a]-1][1];f=!1;h=E/R;g=F/O;for(n=0;n<rechtecke2.length;n++)x=parseInt(rechtecke2[n]%O,10),y=parseInt(rechtecke2[n]/R,10),!0===D(d,[x*h,y*g,x*h+h,y*g+g])&&(f=!0,n=rechtecke2.length);!0===f&&P.push(a)}f=I.getImageData(0,0,E,F);for(a=P.length-1;0<=a;a--){d=z[c][p[c][P[a]]-1][0];h=z[c][p[c][P[a]]-1][3];g=z[c][p[c][P[a]]-1][4];n=0;u=d[0].x;L=d[0].y;for(q=1;q<d.length;q++)n+=Math.sqrt((d[q].x-u)*(d[q].x-u)+(d[q].y-L)*(d[q].y-L));n=1/n*3;u=[];for(t=q=L=0;t<1+n;t+=n){1<t&&(t=1);var r=
B.evaluiere(3,d,t),r=4*(parseInt(r.y,10)*E+parseInt(r.x,10));200===f.data[r+1]&&(u.push(L),q++);L++}if(3>L-q)e.push([c,-p[c][P[a]]]),p[c][P[a]]=-p[c][P[a]],Z=!1;else{Z=!1;for(t=u.length-2;0<=t;t--)2===u[t+1]-u[t]&&u.splice(t+1,0,u[t]+1);q=0;L=[];for(t=0;t<u.length;t++)1<u[t]-q&&(q=B.zerlege(d,q*n,(u[t]-1)*n),L.push(q)),q=u[t];0<u.length&&1>u[u.length-1]*n&&(q=B.teile(d,u[u.length-1]*n,1)[1],L.push(q));if(0<L.length){e.push([c,-p[c][P[a]]]);p[c][P[a]]=-p[c][P[a]];q=z[c].length;for(n=0;n<L.length;n++)z[c].push([L[n],
B.findeRechtecksHuelle(L[n]),1,h,g]),p[c].splice(P[a],0,z[c].length);e.push([c,q+1,z[c].length])}}}X[N]=e;N++;0==Z&&U();aa=[];d=I.createImageData(E,F);for(a=0;a<d.length;a+=4)d[a]=255,d[a+1]=255,d[a+2]=255,d[a+3]=0;I.putImageData(d,0,0);ea=!1;J(k,0,k,!0)}else{aa=[];d=I.createImageData(E,F);for(a=0;a<d.length;a+=4)d[a]=255,d[a+1]=255,d[a+2]=255,d[a+3]=0;I.putImageData(d,0,0);ea=!1}}}}}function U(){for(var b=N;b<X.length;b++)X.splice(b,1)}function J(b,a,d,f){for(var c=0,e=0,h=0;h<l.length;h++)for(var g=
0;g<bilder[h].length;g++)1==H[h]&&null==bilder[h][g].img&&e++;g=I.createImageData(E,F);for(h=0;h<g.length;h+=4)g[h]=255,g[h+1]=255,g[h+2]=255,g[h+3]=0;I.putImageData(g,0,0);a<=b&&G.putImageData(g,0,0);d>b&&na.putImageData(g,0,0);for(h=a;h<=d;h++){a=G;h>b&&(a=na);var n=l[h];if(1==H[n]){if(1==f&&null!=bilder[n])for(g=0;g<bilder[n].length;g++){this.bild=bilder[n][g];var u=new Image;null==bilder[n][g].img?(u.onload=function(){c++;c==e&&J(k,0,l.length-1,!0)},bilder[n][g].img=u,u.width=bilder[n][g].breite,
u.height=bilder[n][g].hoehe,u.x=bilder[n][g].x,u.y=bilder[n][g].y,u.src=bilder[n][g].data):(a.drawImage(bild.img,bild.x,bild.y,bild.breite,bild.hoehe),1==da&&(a.strokeStyle=ga[n],a.beginPath(),a.lineWidth="5",a.rect(bild.x,bild.y,bild.breite,bild.hoehe),a.moveTo(bild.x,bild.y),a.lineTo(bild.x+bild.breite,bild.y+bild.hoehe),a.moveTo(bild.x+bild.breite,bild.y),a.lineTo(bild.x,bild.y+bild.hoehe),a.stroke()))}if(null!=z[n])for(g=0;g<p[n].length;g++)0<p[n][g]&&(u=z[n][p[n][g]-1][0],a.beginPath(),a.moveTo(u[0].x,
u[0].y),a.strokeStyle=z[n][p[n][g]-1][4],1==da&&(a.strokeStyle=ga[n]),a.lineCap="round",a.lineWidth=""+z[n][p[n][g]-1][3],a.bezierCurveTo(u[1].x,u[1].y,u[2].x,u[2].y,u[3].x,u[3].y),a.stroke())}}}function w(b,a){this.x=b;this.y=a}var k,T,E,F,ca,R,O,S,V,ka,W,ua,ja,P,K,ta,Q,pa,ia,ha,Y,I,G,na,z,la,oa,ma,ea,aa,qa,ra,va,p,X,N,Z;var ga="#00ff00 #FF0000 #0000FF #008000 #FFA500 #EB4DFF #808000 #808080 #ADD8E6 #62FFFF #00FF00 #00FFFF #FF00FF".split(" ");var fa="";for(var M=0;M<ga.length;M++);fa+="<input id='farben'  type='color' value='#000000' list='color' /><datalist id='color'><option>#000000</option><option>#ff0000</option><option>#0000ff</option><option>#00ff00</option><option>#ffff00</option><option>#008000</option><option>#a52a2a</option><option>#ffa500</option><option>#999999</option><option>#00ffff</option></datalist>";
var ba=[1,2,3,4,5,6,8,10,12,20,30,40,50];fa+="<span vertical-align='center'><select id='dicken'>";for(M=0;M<ba.length;M++)fa=1==M?fa+("<option selected dicke='"+ba[M]+"'>"+ba[M]+"</option> "):fa+("<option dicke='"+ba[M]+"'>"+ba[M]+"</option> ");fa+="</select>";var da=0,sa=[0,1,2,3,4,5,6,7,8,9];var H=[1,1,1,1,1,1,1,1,1,1];var l=[0,1,2,3,4,5,6,7,8,9];for(M=0;M<sa.length;M++)fa+="<button class='layer' layer='"+sa[M]+"' >"+sa[M]+"</button>";var wa=this;this.init=function(b,a,d,f,c,e){function h(a){a.preventDefault();
aa=[];ma=!0;ea=!1;la=!0;A(a)}function g(a){a.preventDefault();!0===la&&A(a)}function n(a){a.preventDefault();!0===la&&(ea=!0,la=ma=!1,A(a))}H=[1,1,1,1,1,1,1,1,1,1];E=a;F=d;qa=b;va=f;$(b).html("<div id='rahmen' style='position: relative;'> <canvas id='layer1' width='"+E+"' height='"+F+"' style='z-index: 0;'></canvas> <canvas id='layer2'  width='"+E+"' height='"+F+"' style='position: absolute; left: 0; top: 0; z-index: 1;'></canvas><canvas id='layer3' width='"+E+"' height='"+F+"' style='position: absolute; left: 0; top: 0; z-index: 2;'></canvas> </div>");
$(f).html(" <button class='imageUndo holen knopf'  id='zurueck'  /><button class='imageRedo holen knopf'  id='vor'  /><button class='imageRaster holen knopf' b='Raster \u00e4ndern' id='raster'  /><button  class='bild imageDelete holen knopf' b='Aktive Ebene l\u00f6schen' id='loeschenAktiv' alt='aktive Ebene leeren' /><button id='bild' class='imageFotoNeu' alt='neuesFoto'></button><button class='imageFotoLoeschen holen knopf' b='Aktive Ebene l\u00f6schen' id='loescheBilder'  /><button class='imagePen holen knopf' b='Stift' id='stift' /><button class='imageRubber holen knopf' b='Radierer' id='radierer' /><button id='ebenenBunt' class='imageLayer'></button><button id='ebenenAnAus' class='imageLayerOnOff'></button>"+
fa+"<div id='ausgabe'></div><div id='info' >");$(b).append("<div id='qreator_svgbild'></div>");I=$("#layer2")[0].getContext("2d");I.strokeStyle="#ff0000";T=$("#layer3")[0];N=0;ca=.03;O=R=5;S=[[[],[],""],[[25],[25],"#aaaaff"],[[],[50],"#aaaaff"],[[],[60,74,88,102,116],"#000000"]];V=0;ka=2;W="#000000";ua=2;ja=[];rechtecke2=[];P=[];ra=10;ka=1;K=2;Y=0;k=2;da=0;Q=ta=1;pa=[];ha=ia=0;G=$("#layer1")[0].getContext("2d");na=$("#layer3")[0].getContext("2d");z=[];bilder=[];p=[];X=[];for(b=0;b<l.length;b++)z[b]=
[],bilder[b]=[],p[b]=[];Z=!0;la=!1;oa=0;ea=ma=!1;aa=[];window.PointerEvent?(T.addEventListener("pointerdown",function(a){"pen"!=a.pointerType&&"mouse"!=a.pointerType||h(a)}),T.addEventListener("pointermove",function(a){"pen"!=a.pointerType&&"mouse"!=a.pointerType||g(a)}),T.addEventListener("pointerup",function(a){"pen"!=a.pointerType&&"mouse"!=a.pointerType||n(a)})):(T.addEventListener("mousedown",h),T.addEventListener("mousemove",g),T.addEventListener("mouseup",n));$("#ebenenBunt").click(function(){da=
(da+1)%2;$(".layer").each(function(a){1==da&&1==H[a]?($(this).attr("style","background-color: "+ga[a]+";"),$("#ebenenBunt").addClass("aktiv")):($(this).removeAttr("style"),$("#ebenenBunt").removeClass("aktiv"))});J(k,0,l.length-1,!0);v()});$("#ebenenAnAus").click(function(){for(var a=0,b=0;b<l.length;b++)1==H[b]&&a++;if(0<=a&&10>a)for(b=0;b<l.length;b++)H[b]=1;else for(b=0;b<l.length;b++)H[b]=0;J(k,0,l.length-1,!0);v()});$("#zurueck").click(function(a){if(0<N){N--;if(0<=N){Z=!0;for(var b=X[N],c=0;c<
b.length;c++)if(3==b[c].length){a=b[c][0];for(var d=b[c][1],e=b[c][2],f=0;f<p[a].length;f++)Math.abs(p[a][f])>=Math.abs(d)&&Math.abs(p[a][f])<=Math.abs(e)&&(p[a][f]=-p[a][f])}else if(2==b[c].length)for(a=b[c][0],d=b[c][1],f=0;f<p[a].length;f++)Math.abs(p[a][f])==Math.abs(d)&&(p[a][f]=-p[a][f],f=p[a].length)}J(k,0,l.length-1,!0)}});$("#vor").click(function(a){if(1==Z&&N<X.length){Z=!0;for(var b=X[N],c=0;c<b.length;c++)if(3==b[c].length){a=b[c][0];for(var d=b[c][1],f=b[c][2],e=0;e<p[a].length;e++)Math.abs(p[a][e])>=
Math.abs(d)&&Math.abs(p[a][e])<=Math.abs(f)&&(p[a][e]=-p[a][e])}else if(2==b[c].length)for(a=b[c][0],d=b[c][1],e=0;e<p[a].length;e++)Math.abs(p[a][e])==Math.abs(d)&&(p[a][e]=-p[a][e],e=p[a].length);N++;J(k,0,l.length-1,!0)}});$("#tbutton").click(function(a){a.preventDefault();a=$("#svgText").val();wa.loadSVG(a)});$("#download").click(function(a){a.preventDefault();a=$("html").html();window.open("data:text/csv,"+a)});$("#farben").change(function(a){a.preventDefault();W=$(this).val();Y=0;K=ba[ka];$("#stift").focus();
v()});$("#dicken").change(function(a){a.preventDefault();a=parseInt($(this).prop("selectedIndex"));0==Y?ka=a:ra=a;K=ba[a];v()});$(".layer").click(function(a){a.preventDefault();a=parseInt($(this).attr("layer"));1==H[a]?k==a?H[a]=0:(k=a,null==z[k]&&(z[k]=[])):(H[a]=1,k=a,null==z[k]&&(z[k]=[]));J(l[k],0,l.length-1,!0);v()});$(".check").click(function(a){a=0;1==$(this).prop("checked")&&(a=1);H[parseInt($(this).attr("value"))]=a;J(l[k],0,l.length-1,!0);v()});$("#radierer").click(function(a){a.preventDefault();
Y=1;K=ba[ra];v()});$("#stift").click(function(){K=ba[ka];Y=0;v()});$("#raster").click(function(a){a.preventDefault();V=(V+1)%4;var b=S[V][0];a=S[V][1];var c=S[V][2];z[0]=[];p[0]=[];new w(0,0);new w(0,0);if(0<b.length)for(var d=0;d<E;d+=b[b.length-1])for(var e=0;e<b.length;e++){var f=new w(d+b[e],0);var g=new w(d+b[e],F);g=[f,B.addiere(f,B.multipliziereMitSkalar(B.subtrahiere(g,f),1/3)),B.addiere(f,B.multipliziereMitSkalar(B.subtrahiere(g,f),2/3)),g];z[0].push([g,B.findeRechtecksHuelle(g),0,2,c]);
p[0].push(z[0].length)}if(0<a.length)for(b=0;b<F;b+=a[a.length-1])for(e=0;e<a.length;e++)f=new w(0,b+a[e]),g=new w(E,b+a[e]),g=[f,B.addiere(f,B.multipliziereMitSkalar(B.subtrahiere(g,f),1/3)),B.addiere(f,B.multipliziereMitSkalar(B.subtrahiere(g,f),2/3)),g],z[0].push([g,B.findeRechtecksHuelle(g),0,2,c]),p[0].push(z[0].length);J(l[k],0,l[k],!0)});$("#loeschenAktiv").click(function(a){a.preventDefault();var b=G.createImageData(E,F);for(a=0;a<b.length;a+=4)b[a]=255,b[a+1]=255,b[a+2]=255,b[a+3]=0;G.putImageData(b,
0,0);b=[];for(a=0;a<p[l[k]].length;a++)0<p[l[k]][a]&&(p[l[k]][a]=-p[l[k]][a],b.push([l[k],p[l[k]][a]]));X[N]=b;N++;U();J(k,0,k,!0)});$("#loescheBilder").click(function(){1==confirm("Sind Sie sicher, dass alle Bilder in der aktiven Ebene gel\u00f6scht werden sollen? Dieser Schritt kann nicht r\u00fcckg\u00e4ngig gemacht werden.")&&(bilder[l[k]]=[],J(k,0,k,!0))});$("#loeschen").click(function(a){a.preventDefault();a=G.createImageData(E,F);for(var b=0;b<a.length;b+=4)a[b]=255,a[b+1]=255,a[b+2]=255,a[b+
3]=0;G.putImageData(a,0,0);na.putImageData(a,0,0);for(b=0;b<l.length;b++)z[l[b]]=[],p[l[b]]=[];X=[]});$("#knopf").click(function(a){a.preventDefault();QreatorBezier.showSVG()});v()};this.loescheBild=function(){for(var b=0;b<l.length;b++)0<bilder[b].length&&!1===bilder[b][bilder[b].length-1].behalten&&bilder[b].pop();J(k,0,k,!0)};this.ladeBild=function(b,a,d,f,c,e){var h=document.createElement("canvas");h.width=f;h.height=c;h.getContext("2d").drawImage(b,0,0,f,c);b=h.toDataURL();a={img:null,ebene:k,
nr:bilder[l[k]].length,data:b,breite:f,hoehe:c,x:a,y:d,behalten:e};for(d=0;d<l.length;d++)0<bilder[d].length&&!1===bilder[d][bilder[d].length-1].behalten&&bilder[d].pop();bilder[l[k]].push(a);J(k,0,k,!0)};this.insertImgAsSVG=function(b,a,d,f,c){$("#content").append("<div id='qreator_svgbild'></div>");$("#qreator_svgbild").html("<svg  width='"+a+"' height='"+a/b.width*b.height+"' id='qreator_svgbild2' class='qreator_svg'><g fill='none' stroke-linecap='round' id='global'></g>");$("#qreator_svgbild2 #global").append("<g id='layer_2'></g>");
$("#qreator_svgbild2 #global #layer_2").append(document.createElementNS("http://www.w3.org/2000/svg","image"));$("#qreator_svgbild2 #global #layer_2 image").last().attr("bildnr","0").attr("x","0").attr("y","0").attr("width",""+a).attr("height",""+a/b.width*b.height).attr("xlink:href",""+b.src).attr("hoeheoriginal",""+a/b.width*b.height);$("#"+f).before("<div class='zeichenflaeche tshareElement zeichenflaecheKlick' >"+$("#qreator_svgbild").html()+"</div>"+c);$("#qreator_svgbild2").removeAttr("id");
$("#qreator_svgbild").html("");$("#qreator_svgbild").remove()};this.showSVG=function(b){var a="",d=0;$("#qreator_svgbild").html("<svg  width='"+E+"' height='"+F+"' id='qreator_svgbild2' class='qreator_svg'><g fill='none' stroke-linecap='round' id='global'></g>");for(var f=0;f<l.length;f++){var c=l[f];if(null!=z[c]&&0<z[c].length||null!=bilder[c]&&0<bilder[c].length){var e="";0==H[f]&&(e="visibility='hidden'");$("#qreator_svgbild2 #global").append("<g id='layer_"+c+"' "+e+"></g>");if(null!=bilder[c])for(e=
0;e<bilder[c].length;e++){var h=bilder[c][e];$("#qreator_svgbild2 #global #layer_"+c).append(document.createElementNS("http://www.w3.org/2000/svg","image"));$("#qreator_svgbild2 #global #layer_"+c+" image").last().attr("bildnr",e).attr("x",""+h.x).attr("y",""+h.y).attr("width",""+h.breite).attr("height",""+h.hoehe).attr("xlink:href",""+h.data);h.y+h.hoehe>d&&(d=h.y+h.hoehe)}if(null!=z[c]&&0<z[c].length){for(var e="",h=z[c][0][0][3],g="",n="",u="",k="",t=0;t<p[c].length;t++){var q=p[c][t];if(0<q){M=
q-1;var q=z[c][M][0],v=z[c][M][4],w=z[c][M][3],C=z[c][M][1][3];C>d&&0<c&&(d=C);if(v!=g||w!=n)u=" stroke='"+v+"'",g=v,u+=" stroke-width='"+w+"'",n=w;0<u.length&&(0<e.length&&(a+="<path d='"+e+"' "+k+" />",h={x:-1,y:-1},e=""),k=u,u="");e=0<M&&q[0].x===h.x&&q[0].y===h.y?e+(" c "+r(q[1].x-q[0].x,Q)+" "+r(q[1].y-q[0].y,Q)+" "+r(q[2].x-q[0].x,Q)+" "+r(q[2].y-q[0].y,Q)+" "+r(q[3].x-q[0].x,Q)+" "+r(q[3].y-q[0].y,Q)):e+(" M "+r(q[0].x,Q)+" "+r(q[0].y,Q)+" c "+r(q[1].x-q[0].x,Q)+" "+r(q[1].y-q[0].y,Q)+" "+
r(q[2].x-q[0].x,Q)+" "+r(q[2].y-q[0].y,Q)+" "+r(q[3].x-q[0].x,Q)+" "+r(q[3].y-q[0].y,Q));h=z[c][M][0][3];2E3<e.length&&(a+="<path d='"+e+"' "+k+" />",h={x:-1,y:-1},e="",1E4<a.length&&($("#qreator_svgbild2 #global #layer_"+c).append(a),a=""),n=g="")}}0<e.length&&(a+="<path d='"+e+"' "+k+" />");0<a.length&&($("#qreator_svgbild2 #global #layer_"+c).append(a),a="")}}}$("#qreator_svgbild svg").attr("height",d).attr("heightoriginal",F);$("#qreator_svgbild #qreator_svgbild2").removeAttr("id");$("#qreator_svgbild").html();
$(qa).html("<div class='"+b+" tshareElement zeichenflaecheKlick' >"+$("#qreator_svgbild").html()+"</div>");$(qa).find("."+b).unwrap();$(va).html("")};this.loadSVG=function(b){for(var a=0,d=0;d<H.length;d++)H[d]=1;console.log("Breite: "+$(b).attr("width")+", H\u00f6he: "+$(b).attr("height")+", Originalh\u00f6he: "+$(b).attr("heightoriginal"));d=$(b).attr("heightoriginal");void 0!=d&&($("#rahmen canvas").attr("height",parseInt(d)),F=parseInt(d));$(b).find("#global").find("g").each(function(){var b=
parseInt($(this).attr("id").split("_")[1]);z[b]=[];bilder[b]=[];a++;"hidden"==$(this).attr("visibility")&&(H[b]=0);$(this).find("image").each(function(){var a={data:$(this).attr("xlink:href"),x:parseInt($(this).attr("x")),y:parseInt($(this).attr("y")),breite:parseInt($(this).attr("width")),hoehe:parseInt($(this).attr("height")),ebene:b,nr:bilder[b].length};bilder[b].push(a)});$(this).find("path").each(function(){for(var a=$(this).attr("stroke"),d=parseInt($(this).attr("stroke-width")),f=$(this).attr("d").trim().split("M"),
g=0;g<f.length;g++)if(""!=f[g]){for(var n=f[g].split("c"),u=n[0].split(" "),k=[],t=0;t<u.length;t++)""!=u[t]&&k.push(u[t]);u=[];t=new w(parseFloat(k[0]),parseFloat(k[1]));u.push(t);for(k=1;k<n.length;k++){for(var q=n[k].split(" "),l=[],t=0;t<q.length;t++)""!=q[t]&&l.push(q[t]);if(6<=l.length)for(q=0;6>q;q+=2)t=new w(parseFloat(l[q])+u[0].x,parseFloat(l[q+1])+u[0].y),u.push(t);z[b].push([u,B.findeRechtecksHuelle(u),0,d,a]);p[b].push(z[b].length);4==u.length&&(t=new w(u[3].x,u[3].y),u=[],u.push(t))}}})});
b=[];10>a&&(a=10);for(d=0;d<a;d++)b[d]=d,null==H[d]&&(H[d]=1);for(d=0;d<H.length;d++);J(b[k],0,a-1,!0);v()};var B={initialisiere:function(b,a){this.ergebnis=[];this.epsilon=1E-11;this.TOLERANZ=1E-6;var d=null;this.fehler=a;this.punkte=[];for(var f=0;f<b.length;f++){var c=b[f];d&&c.x==d.x&&c.y==d.y||(this.punkte.push(c),d=c)}this.fehler=a},findeRechtecksHuelle:function(b){for(var a=b[0].x,d=a,f=b[0].y,c=f,e=1;e<b.length;e++)a>b[e].x?a=b[e].x:d<b[e].x&&(d=b[e].x),f>b[e].y?f=b[e].y:c<b[e].y&&(c=b[e].y);
return[a-K,f-K,d+K,c+K]},findeKonvexeHuelle:function(b){function a(a,b){var c=a.x-b.x;a=a.y-b.y;return c*c+a*a}function d(b,c,d){var e=(c.x-b.x)*(d.y-b.y)-(d.x-b.x)*(c.y-b.y);return 0<e?!0:0>e?!1:a(b,d)>a(b,c)}for(var f=b.length,c=[],e=0,h=1;h!=f;h++)b[h].y<b[e].y&&(e=h);var e=b[e],g=null;do{c.push(e);g=b[0];for(h=1;h!=f;h++)if(e.x===g.x&&e.y===g.y||d(e,g,b[h]))g=b[h];e=g}while(g.x!==c[0].x||g.y!==c[0].y);return c},parametrisiereKurve:function(b,a){for(var d=[0],f=b+1;f<=a;f++)d[f-b]=d[f-b-1]+this.berechneEntfernungIndex(f,
f-1);b=d[d.length-1];for(a=0;a<d.length;a++)d[a]/=b;return d},berechneEntfernungIndex:function(b,a){var d=this.punkte[b].x-this.punkte[a].x;b=this.punkte[b].y-this.punkte[a].y;return Math.sqrt(d*d+b*b)},berechneEntfernung:function(b,a){var d=b.x-a.x;b=b.y-a.y;return Math.sqrt(d*d+b*b)},normiere:function(b){var a=Math.sqrt(b.x*b.x+b.y*b.y);0!==a&&(b.x/=a,b.y/=a);return b},multipliziereSkalar:function(b,a){return b.x*a.x+b.y*a.y},multipliziereMitSkalar:function(b,a){return{x:b.x*a,y:b.y*a}},addiere:function(b,
a){return{x:b.x+a.x,y:b.y+a.y}},subtrahiere:function(b,a){return{x:b.x-a.x,y:b.y-a.y}},approximiere:function(){var b=this.punkte,a=b.length;this.ergebnis=0<a?[[b[0]]]:[];1<a&&(C(2,"Anzahl der Punkte: "+a),this.approximiereKubisch(0,a-1,this.normiere(this.subtrahiere(b[1],b[0])),this.normiere(this.subtrahiere(b[a-2],b[a-1]))));return this.ergebnis},approximiereKubisch:function(b,a,d,f){if(1===a-b){b=this.punkte[b];a=this.punkte[a];var c=this.berechneEntfernung(b,a)/3;this.ergebnis.push([b,this.addiere(b,
this.multipliziereMitSkalar(this.normiere(d),c)),this.addiere(a,this.multipliziereMitSkalar(this.normiere(f),c)),a])}else{for(var e=this.parametrisiereKurve(b,a),h=Math.max(this.fehler,this.fehler*this.fehler),g=0;4>=g;g++){var n=this.findeBezierNaeherung(b,a,e,d,f);[].push(n);var k=this.findeGroesstenFehler(b,a,n,e);if(k.error<this.fehler){this.ergebnis.push(n);return}c=k.index;if(k.error>=h){C(3,"Maximaler Fehler: "+h+", gemessener Fehler: "+k.error);break}e=this.reparametrisiere(b,a,e,n);h=k.error}e=
this.subtrahiere(this.punkte[c-1],this.punkte[c]);h=this.subtrahiere(this.punkte[c],this.punkte[c+1]);e=this.normiere(this.multipliziereMitSkalar(this.addiere(e,h),.5));this.approximiereKubisch(b,c,d,e);this.approximiereKubisch(c,a,this.multipliziereMitSkalar(e,-1),f)}},findeBezierNaeherung:function(b,a,d,f,c){C(3,"findeBezierN\u00e4herung: "+b+" "+a);var e=this.epsilon,h=null,g=null,n=this.punkte[b],k=this.punkte[a],l=[[0,0],[0,0]],t=[0,0];a=a-b+1;for(var q=0;q<a;q++){var p=d[q],r=1-p,v=3*p*r,w=
r*r*r,r=v*r,v=v*p,z=p*p*p,p=this.multipliziereMitSkalar(this.normiere(f),r),B=this.multipliziereMitSkalar(this.normiere(c),v),w=this.subtrahiere(this.subtrahiere(this.punkte[b+q],this.multipliziereMitSkalar(n,w+r)),this.multipliziereMitSkalar(k,v+z));l[0][0]+=this.multipliziereSkalar(p,p);l[0][1]+=this.multipliziereSkalar(p,B);l[1][0]=l[0][1];l[1][1]+=this.multipliziereSkalar(B,B);t[0]+=this.multipliziereSkalar(p,w);t[1]+=this.multipliziereSkalar(B,w)}b=l[0][0]*l[1][1]-l[1][0]*l[0][1];if(Math.abs(b)>
e){var A=l[0][0]*t[1]-l[1][0]*t[0];t=(t[0]*l[1][1]-t[1]*l[0][1])/b;A/=b}else b=l[0][0]+l[0][1],l=l[1][0]+l[1][1],t=Math.abs(b)>e?A=t[0]/b:Math.abs(l)>e?A=t[1]/l:A=0;l=this.berechneEntfernung(n,k);e*=l;t<e||A<e?t=A=l/3:(e=this.subtrahiere(k,n),h=this.multipliziereMitSkalar(this.normiere(f),t),g=this.multipliziereMitSkalar(this.normiere(c),A),this.multipliziereSkalar(h,e)-this.multipliziereSkalar(g,e)>l*l&&(t=A=l/3,h=g=null));f=this.multipliziereMitSkalar(this.normiere(f),t);c=this.multipliziereMitSkalar(this.normiere(c),
A);null!=h&&(f=h);null!=g&&(c=g);return[n,this.addiere(n,f),this.addiere(k,c),k]},evaluiere:function(b,a,d){a=a.slice();for(var f=1;f<=b;f++)for(var c=0;c<=b-f;c++)a[c]=this.addiere(this.multipliziereMitSkalar(a[c],1-d),this.multipliziereMitSkalar(a[c+1],d));return a[0]},teile:function(b,a){for(var d=b.slice(),f=[],c=1;3>=c;c++)for(var e=0;e<=3-c;e++)d[e]=this.addiere(this.multipliziereMitSkalar(d[e],1-a),this.multipliziereMitSkalar(d[e+1],a)),f.push(d[e]);return[[b[0],f[0],f[3],f[5]],[f[5],f[4],
f[2],b[3]]]},zerlege:function(b,a,d){b=this.teile(b,a)[1];return this.teile(b,(d-a)/(1-a))[0]},findeGroesstenFehler:function(b,a,d,f){for(var c=Math.floor((a-b+1)/2),e=0,h=b+1;h<a;h++){var g=this.evaluiere(3,d,f[h-b]),g=this.subtrahiere(g,this.punkte[h]),g=g.x*g.x+g.y*g.y;g>=e&&(e=g,c=h)}return{error:e,index:c}},reparametrisiere:function(b,a,d,f){for(var c=b;c<=a;c++)d[c-b]=this.findeNullstelle(f,this.punkte[c],d[c-b]);return d},findeNullstelle:function(b,a,d){for(var f=[],c=[],e=0;2>=e;e++)f[e]=
this.multipliziereMitSkalar(this.subtrahiere(b[e+1],b[e]),3);for(e=0;1>=e;e++)c[e]=this.multipliziereMitSkalar(this.subtrahiere(f[e+1],f[e]),2);b=this.evaluiere(3,b,d);f=this.evaluiere(2,f,d);c=this.evaluiere(1,c,d);a=this.subtrahiere(b,a);c=this.multipliziereSkalar(f,f)+this.multipliziereSkalar(a,c);return Math.abs(c)<this.TOLERANZ?d:d-this.multipliziereSkalar(a,f)/c}}};
