var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(w,C,v){w!=Array.prototype&&w!=Object.prototype&&(w[C]=v.value)};$jscomp.getGlobal=function(w){return"undefined"!=typeof window&&window===w?w:"undefined"!=typeof global&&null!=global?global:w};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(w,C,v,D){if(C){v=$jscomp.global;w=w.split(".");for(D=0;D<w.length-1;D++){var A=w[D];A in v||(v[A]={});v=v[A]}w=w[w.length-1];D=v[w];C=C(D);C!=D&&null!=C&&$jscomp.defineProperty(v,w,{configurable:!0,writable:!0,value:C})}};$jscomp.polyfill("Array.prototype.fill",function(w){return w?w:function(w,v,D){var A=this.length||0;0>v&&(v=Math.max(0,A+v));if(null==D||D>A)D=A;D=Number(D);0>D&&(D=Math.max(0,A+D));for(v=Number(v||0);v<D;v++)this[v]=w;return this}},"es6-impl","es3");
$jscomp.findInternal=function(w,C,v){w instanceof String&&(w=String(w));for(var D=w.length,A=0;A<D;A++){var Y=w[A];if(C.call(v,Y,A,w))return{i:A,v:Y}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(w){return w?w:function(w,v){return $jscomp.findInternal(this,w,v).v}},"es6-impl","es3");
(function(){function w(v,D,A,Y,C){for(var U=Y,S,K=D+1;K<A;K++){var t=v[K];var k=v[D],N=v[A],G=k.x,k=k.y,F=N.x-G,T=N.y-k;if(0!==F||0!==T){var R=((t.x-G)*F+(t.y-k)*T)/(F*F+T*T);1<R?(G=N.x,k=N.y):0<R&&(G+=F*R,k+=T*R)}F=t.x-G;T=t.y-k;t=F*F+T*T;t>U&&(S=K,U=t)}U>Y&&(1<S-D&&w(v,D,S,Y,C),C.push(v[S]),1<A-S&&w(v,S,A,Y,C))}function C(v,D,A){if(2>=v.length)return v;D=void 0!==D?D*D:1;if(A)var C=v;else{A=v[0];for(var ka=[A],U=1,S=v.length;U<S;U++){C=v[U];var K=C.x-A.x,t=C.y-A.y;K*K+t*t>D&&(ka.push(C),A=C)}A!==
C&&ka.push(C);C=ka}v=C.length-1;A=[C[0]];w(C,0,v,D,A);A.push(C[v]);return A}"function"===typeof define&&define.amd?define(function(){return C}):"undefined"!==typeof module?module.exports=C:"undefined"!==typeof self?self.simplify=C:window.simplify=C})();
var QreatorBezier=new function(){function w(){if(0==Z){$(".layer").removeClass("aktivBunt");$("#dicken option").prop("selected",!1).filter("[dicke='"+L+"']").prop("selected",!0);$(".layer").each(function(){$(this).removeClass("sichtbar")});$(".layer").each(function(){$(this).removeClass("unsichtbar")});$(".layer").removeClass("aktivLayer");for(var a=0;a<l.length;a++)1==I[a]?$("[layer='"+l[a]+"']").addClass("sichtbar"):$("[layer='"+l[a]+"']").addClass("unsichtbar");$(".layer").removeAttr("style");
$(".layer").each(function(a){1==da&&1==I[a]&&($(this).attr("style","background-color: "+la[a]+";"),a==k&&$(this).addClass("aktivBunt"))});1==I[k]&&$("[layer='"+l[k]+"']").addClass("aktivLayer");$("#radierer").removeClass("aktiv");$("#stift").addClass("aktiv")}else{$(".layer").removeClass("aktivBunt");$("#dicken option").prop("selected",!1).filter("[dicke='"+L+"']").prop("selected",!0);$(".layer").each(function(){$(this).removeClass("sichtbar")});$(".layer").each(function(){$(this).removeClass("unsichtbar")});
for(a=0;a<l.length;a++)1==I[a]?$("[layer='"+l[a]+"']").addClass("sichtbar"):$("[layer='"+l[a]+"']").addClass("unsichtbar");$(".layer").removeAttr("style");$(".layer").each(function(a){1==da&&1==I[a]&&($(this).attr("style","background-color: "+la[a]+";"),a==k&&$(this).addClass("aktivBunt"))});$(".layer").removeClass("aktivLayer");1==I[k]&&$("[layer='"+l[k]+"']").addClass("aktivLayer");$("#radierer").addClass("aktiv");$("#stift").removeClass("aktiv")}var a=document.createElement("canvas"),b=L*window.devicePixelRatio;
a.width=b+3;a.height=b+3;var d=a.getContext("2d");d.beginPath();b=parseInt(b/2);0==b&&(b=1);d.arc(b+1,b+1,b,0,2*Math.PI);0==Z?(d.fillStyle=V,d.strokeStyle=V):(d.strokeStyle="rgba(255,200,200,1)",d.fillStyle="rgba(255,200,200,1)");d.stroke();d.fill();a="url("+a.toDataURL()+")"+(b-2)+" "+(b-2)+",auto";$("#layer3").css("cursor",a)}function C(a,b){a<=ua&&$("#ausgabe").append(b+"<br>")}function v(a,b){m=1;for(var d=0;d<b;d++)m*=10;return parseInt(a*m,10)/m}function D(a,b){if(0===aa.length){J.beginPath();
J.moveTo(a,b);oa=a;ma=b;pa=[];J.lineWidth=""+L;J.strokeStyle=V;J.lineCap="round";for(var d=0;d<R*ha;d++)pa[d]=0}else{J.lineTo(a,b);if(1===Z){J.lineWidth=""+L;J.strokeStyle="rgba(255,200,200,1)";var d=a;oa<a&&(d=oa);var f=b,h=ma;ma<b&&(f=ma,h=b);d-=L;var c=d+L;f-=L;h+=L;d=parseInt(d/(1*G/R),10);c=parseInt(c/(1*G/R),10);f=parseInt(f/(1*F/ha),10);for(h=parseInt(h/(1*F/ha),10);d<=c;d++)for(var e=f;e<=h;e++)pa[e*R+d]=1;oa=a;ma=b}J.stroke();J.beginPath();J.moveTo(a,b)}aa.push(new t(a,b))}function A(a){if(1==
I[k]){if(!0===ea){var b=a.targetTouches[0].pageX-N.offsetLeft-$("#rahmen")[0].offsetLeft;a=a.targetTouches[0].pageY-N.offsetTop-$("#rahmen")[0].offsetTop;D(b,a)}!0===W&&Y()}}function Y(){var a;if(!0===W){rechtecke2=[];for(var b=0;b<R*ha;b++)1===pa[b]&&rechtecke2.push(b);va=B.findeRechtecksHuelle(aa);if(0===Z){var b=aa,d;if(1===b.length){var f=b[0].x;var h=b[0].y;b=[];b.push(new t(f-1,h-1));b.push(new t(f+1,h-1));b.push(new t(f+1,h+1));b.push(new t(f-1,h+1))}h=!1;var c=f=b[0].x;var e=a=b[0].y;for(d=
1;d<b.length;d++){var g=b[d];g.x>c?c=g.x:g.x<f&&(f=g.x);g.y>e?e=g.y:g.y<a&&(a=g.y)}c=[f,a,c,e];a=parseInt(Math.max(c[2]-c[0],c[3]-c[1])/5,10);f=B.berechneEntfernung(b[0],b[b.length-1]);if(f<a){e=c[0];d=c[2];g=c[1];var n=c[3];a=1*(d-e)/(n-g);if(1.5>a&&.8<a){a=.25*(d-e+(n-g));e=new t(.5*(e+d),.5*(g+n));d=!0;for(c=0;c<b.length;c++)g=B.berechneEntfernung(e,b[c]),g<1.3*a&&g>.8*a||(d=!1,c=b.length);!0===d&&(erg=[],erg.push([new t(e.x,e.y+a),new t(e.x+.551915024494*a,e.y+a),new t(e.x+a,e.y+.551915024494*
a),new t(e.x+a,e.y)]),erg.push([new t(e.x+a,e.y),new t(e.x+a,e.y-.551915024494*a),new t(e.x+.551915024494*a,e.y-a),new t(e.x,e.y-a)]),erg.push([new t(e.x,e.y-a),new t(e.x-.551915024494*a,e.y-a),new t(e.x-a,e.y-.551915024494*a),new t(e.x-a,e.y)]),erg.push([new t(e.x-a,e.y),new t(e.x-a,e.y+.551915024494*a),new t(e.x-.551915024494*a,e.y+a),new t(e.x,e.y+a)]),h=!0)}else{a=parseInt(Math.max(c[2]-c[0],c[3]-c[1])/20,10);20<a&&(a=20);e=[];for(c=0;c<b.length;c++)e.push(new t(b[c].x,b[c].y));e=window.simplify(e,
a,!0);erg=[];if(3<e.length&&6>e.length){e[e.length-1]=e[0];if(5==e.length)for(c=0;c<e.length-1;c++)g=e[c],d=e[c+1],a=d.x-g.x,h=d.y-g.y,0!==h&&(d=1*h/a,.3>Math.abs(d)&&(3==c?(e[c+1].y=e[0].y,e[c].y=e[c+1].y):e[c+1].y=e[c].y)),0!==a&&(d=1*a/h,.3>Math.abs(d)&&(3==c?(e[c+1].x=e[0].x,e[c].x=e[c+1].x):e[c+1].x=e[c].x));for(c=0;c<e.length-1;c++)g=new t(e[c].x,e[c].y),d=new t(e[c+1].x,e[c+1].y),erg.push([g,B.addiere(g,B.multipliziereMitSkalar(B.subtrahiere(d,g),1/3)),B.addiere(g,B.multipliziereMitSkalar(B.subtrahiere(d,
g),2/3)),d]);h=!0}}}if(!1===h){a=parseInt(f/20,10);erg=[];f=b;c=a;a=0;e=!0;for(d=1;d<f.length-1;d++){g=f[d];var n=f[0],q=f[f.length-1];if(n.x===q.x)g=Math.abs(g.x-n.x);else{var E=new t(q.x-n.x,q.y-n.y),u=new t(g.x-n.x,g.y-n.y);var r=Math.sqrt(E.x*E.x+E.y*E.y);u=(u.x*E.x+u.y*E.y)/r;u>r?(n=new t(q.x-g.x,q.y-g.y),g=Math.sqrt(n.x*n.x+n.y*n.y)):0>u?(n=new t(g.x-n.x,g.y-n.y),g=Math.sqrt(n.x*n.x+n.y*n.y)):(n=new t(n.x+u*E.x/r,n.y+u*E.y/r),g=new t(n.x-g.x,n.y-g.y),g=Math.sqrt(g.x*g.x+g.y*g.y))}g>a&&(a=g,
a>c&&(e=!1,d=f.length))}!0===e&&(g=b[0],d=b[b.length-1],a=d.x-g.x,h=d.y-g.y,0!==h&&Math.abs(1*h/a)<T&&(f=(g.y+d.y)/2,g.y=f,d.y=f),0!==a&&Math.abs(1*a/h)<T&&(f=(g.x+d.x)/2,g.x=f,d.x=f),erg=[[g,B.addiere(g,B.multipliziereMitSkalar(B.subtrahiere(d,g),1/3)),B.addiere(g,B.multipliziereMitSkalar(B.subtrahiere(d,g),2/3)),d]],h=!0)}B.initialisiere(b,za);a=B.approximiere();if(0<b.length){f=J.createImageData(G,F);for(c=0;c<f.length;c+=4)f[c]=255,f[c+1]=255,f[c+2]=255,f[c+3]=0;J.putImageData(f,0,0)}e=z[l[k]].length;
for(c=0;c<a.length;c++)f=a[c],1===f.length?0==h&&(H.beginPath(),H.fillStyle=V,H.fillRect(f[0].x,f[0].y,1,1)):4===f.length&&(0==h&&(H.beginPath(),H.moveTo(f[0].x,f[0].y),H.strokeStyle=V,H.lineCap="round",H.lineWidth=""+L,H.bezierCurveTo(f[1].x,f[1].y,f[2].x,f[2].y,f[3].x,f[3].y),C(3,f[0].x+"/"+f[0].y+","+f[1].x+"/"+f[1].y+","+f[2].x+"/"+f[2].y+","+f[3].x+"/"+f[3].y),H.stroke()),z[l[k]].push([f,B.findeRechtecksHuelle(f),0,L,V]),p[l[k]].push(z[l[k]].length),ba=!1);0==ba&&S();X[O]=[[l[k],e+1,z[l[k]].length]];
O++;a=z[l[k]].length;if(1==h){for(c=0;c<erg.length;c++)f=erg[c],1===f.length?(H.beginPath(),H.fillStyle=V,H.fillRect(f[0].x,f[0].y,1,1)):4===f.length&&(H.beginPath(),H.moveTo(f[0].x,f[0].y),H.strokeStyle=V,H.lineCap="round",H.lineWidth=""+L,H.bezierCurveTo(f[1].x,f[1].y,f[2].x,f[2].y,f[3].x,f[3].y),C(3,f[0].x+"/"+f[0].y+","+f[1].x+"/"+f[1].y+","+f[2].x+"/"+f[2].y+","+f[3].x+"/"+f[3].y),H.stroke(),z[l[k]].push([f,B.findeRechtecksHuelle(f),0,L,V]),p[l[k]].push(z[l[k]].length),ba=!1);for(c=0;c<p[l[k]].length;c++)Math.abs(p[l[k]][c])>=
Math.abs(e+1)&&Math.abs(p[l[k]][c])<=Math.abs(a)&&(p[l[k]][c]=-p[l[k]][c]);X[O]=[[l[k],e+1,a],[l[k],a+1,z[l[k]].length]];O++}if(2<ua)for(c=0;c<b.length;c++)f=b[c].x,h=b[c].y,J.fillStyle="#ff0000",J.fillRect(f-2,h-2,5,5);aa=[];W=!1}else if(1===Z){h=[];for(b=0;b<l.length;b++)h[b]=0,b==l[k]&&(h[b]=1);f=[];for(c=0;c<h.length;c++)if(0<h[c])if(null!=z[c]&&0<z[c].length){P=[];if(rechtecke2.length<Aa)for(b=0;b<p[c].length;b++)0<p[c][b]&&(a=z[c][p[c][b]-1][1],!0===ka(va,a)&&P.push(b));else for(b=0;b<p[c].length;b++)if(0<
p[c][b]){a=z[c][p[c][b]-1][1];e=!1;d=G/R;g=F/ha;for(n=0;n<rechtecke2.length;n++)x=parseInt(rechtecke2[n]%ha,10),y=parseInt(rechtecke2[n]/R,10),!0===ka(a,[x*d,y*g,x*d+d,y*g+g])&&(e=!0,n=rechtecke2.length);!0===e&&P.push(b)}e=J.getImageData(0,0,G,F);for(b=P.length-1;0<=b;b--){a=z[c][p[c][P[b]]-1][0];d=z[c][p[c][P[b]]-1][3];g=z[c][p[c][P[b]]-1][4];n=0;q=a[0].x;E=a[0].y;for(r=1;r<a.length;r++)n+=Math.sqrt((a[r].x-q)*(a[r].x-q)+(a[r].y-E)*(a[r].y-E));n=1/n*3;q=[];for(u=r=E=0;u<1+n;u+=n){1<u&&(u=1);var ra=
B.evaluiere(3,a,u),ra=4*(parseInt(ra.y,10)*G+parseInt(ra.x,10));200===e.data[ra+1]&&(q.push(E),r++);E++}if(3>E-r)f.push([c,-p[c][P[b]]]),p[c][P[b]]=-p[c][P[b]],ba=!1;else{ba=!1;for(u=q.length-2;0<=u;u--)2===q[u+1]-q[u]&&q.splice(u+1,0,q[u]+1);r=0;E=[];for(u=0;u<q.length;u++)1<q[u]-r&&(r=B.zerlege(a,r*n,(q[u]-1)*n),E.push(r)),r=q[u];0<q.length&&1>q[q.length-1]*n&&(r=B.teile(a,q[q.length-1]*n,1)[1],E.push(r));if(0<E.length){f.push([c,-p[c][P[b]]]);p[c][P[b]]=-p[c][P[b]];r=z[c].length;for(n=0;n<E.length;n++)z[c].push([E[n],
B.findeRechtecksHuelle(E[n]),1,d,g]),p[c].splice(P[b],0,z[c].length);f.push([c,r+1,z[c].length])}}}X[O]=f;O++;0==ba&&S();aa=[];a=J.createImageData(G,F);for(b=0;b<a.length;b+=4)a[b]=255,a[b+1]=255,a[b+2]=255,a[b+3]=0;J.putImageData(a,0,0);W=!1;K(k,0,k,!0)}else{aa=[];a=J.createImageData(G,F);for(b=0;b<a.length;b+=4)a[b]=255,a[b+1]=255,a[b+2]=255,a[b+3]=0;J.putImageData(a,0,0);W=!1}}}}function ka(a,b){return!(a[0]>b[2]||a[2]<b[0]||a[1]>b[3]||a[3]<b[1])}function U(a){if(1==I[k]){if(!0===ea){var b=a.pageX-
N.offsetLeft-$("#rahmen")[0].offsetLeft;a=a.pageY-N.offsetTop-$("#rahmen")[0].offsetTop;D(b,a)}!0===W&&Y()}}function S(){for(var a=O;a<X.length;a++)X.splice(a,1)}function K(a,b,d,f){for(var h=0,c=0,e=0;e<l.length;e++)for(var g=0;g<bilder[e].length;g++)1==I[e]&&null==bilder[e][g].img&&c++;g=J.createImageData(G,F);for(e=0;e<g.length;e+=4)g[e]=255,g[e+1]=255,g[e+2]=255,g[e+3]=0;J.putImageData(g,0,0);b<=a&&H.putImageData(g,0,0);d>a&&sa.putImageData(g,0,0);for(e=b;e<=d;e++){b=H;e>a&&(b=sa);var n=l[e];
if(1==I[n]){if(1==f&&null!=bilder[n])for(g=0;g<bilder[n].length;g++){this.bild=bilder[n][g];var q=new Image;null==bilder[n][g].img?(q.onload=function(){h++;h==c&&K(k,0,l.length-1,!0)},bilder[n][g].img=q,q.width=bilder[n][g].breite,q.height=bilder[n][g].hoehe,q.x=bilder[n][g].x,q.y=bilder[n][g].y,q.src=bilder[n][g].data):(b.drawImage(bild.img,bild.x,bild.y,bild.breite,bild.hoehe),1==da&&(b.strokeStyle=la[n],b.beginPath(),b.lineWidth="5",b.rect(bild.x,bild.y,bild.breite,bild.hoehe),b.moveTo(bild.x,
bild.y),b.lineTo(bild.x+bild.breite,bild.y+bild.hoehe),b.moveTo(bild.x+bild.breite,bild.y),b.lineTo(bild.x,bild.y+bild.hoehe),b.stroke()))}if(null!=z[n])for(g=0;g<p[n].length;g++)0<p[n][g]&&(q=z[n][p[n][g]-1][0],b.beginPath(),b.moveTo(q[0].x,q[0].y),b.strokeStyle=z[n][p[n][g]-1][4],1==da&&(b.strokeStyle=la[n]),b.lineCap="round",b.lineWidth=""+z[n][p[n][g]-1][3],b.bezierCurveTo(q[1].x,q[1].y,q[2].x,q[2].y,q[3].x,q[3].y),b.stroke())}}}function t(a,b){this.x=a;this.y=b}var k,N,G,F,T,R,ha,ta,na,qa,V,
Aa,pa,P,L,za,Q,va,oa,ma,Z,J,H,sa,z,fa,ia,ja,ua,ea,W,aa,wa,xa,Ba,p,X,O,ba;var la="#00ff00 #FF0000 #0000FF #008000 #FFA500 #EB4DFF #808000 #808080 #ADD8E6 #62FFFF #00FF00 #00FFFF #FF00FF".split(" ");var ga="";for(var M=0;M<la.length;M++);ga+="<input id='farben'  type='color' value='#000000' list='color' /><datalist id='color'><option>#000000</option><option>#ff0000</option><option>#0000ff</option><option>#00ff00</option><option>#ffff00</option><option>#008000</option><option>#a52a2a</option><option>#ffa500</option><option>#999999</option><option>#00ffff</option></datalist>";
var ca=[1,2,3,4,5,6,8,10,12,20,30,40,50];ga+="<span vertical-align='center'><select id='dicken'>";for(M=0;M<ca.length;M++)ga=1==M?ga+("<option selected dicke='"+ca[M]+"'>"+ca[M]+"</option> "):ga+("<option dicke='"+ca[M]+"'>"+ca[M]+"</option> ");ga+="</select>";var da=0,ya=[0,1,2,3,4,5,6,7,8,9];var I=[1,1,1,1,1,1,1,1,1,1];var l=[0,1,2,3,4,5,6,7,8,9];for(M=0;M<ya.length;M++)ga+="<button class='layer' layer='"+ya[M]+"' >"+ya[M]+"</button>";var Ca=this;this.init=function(a,b,d,f,h,c){function e(a){a.preventDefault();
aa=[];ea=!0;W=!1;ja=!0;ia=fa=!1;A(a)}function g(a){a.preventDefault();!0===ja&&1==ea&&A(a)}function n(a){a.preventDefault();!0===ja&&(W=!0,fa=ia=ja=ea=!1,A(a))}function q(a){a.preventDefault();aa=[];ea=!0;ia=ja=fa=W=!1;"pen"==a.pointerType?ia=!0:"mouse"==a.pointerType&&(fa=!0);U(a)}function E(a){a.preventDefault();!0!==fa&&!0!==ia||U(a)}function u(a){a.preventDefault();if(!0===fa||!0===ia)W=!0,ia=ja=fa=ea=!1,U(a)}I=[1,1,1,1,1,1,1,1,1,1];G=b;F=d;wa=a;Ba=f;$(a).html("<div id='rahmen' style='position: relative;'> <canvas id='layer1' width='"+
G+"' height='"+F+"' style='z-index: 0;'></canvas> <canvas id='layer2'  width='"+G+"' height='"+F+"' style='position: absolute; left: 0; top: 0; z-index: 1;'></canvas><canvas id='layer3' width='"+G+"' height='"+F+"' style='position: absolute; left: 0; top: 0; z-index: 2;'></canvas> </div>");$(f).html(" <button class='imageUndo holen knopf'  id='zurueck'  /><button class='imageRedo holen knopf'  id='vor'  /><button class='imageRaster holen knopf' b='Raster \u00e4ndern' id='raster'  /><button  class='bild imageDelete holen knopf' b='Aktive Ebene l\u00f6schen' id='loeschenAktiv' alt='aktive Ebene leeren' /><button id='bild' class='imageFotoNeu' alt='neuesFoto'></button><button class='imageFotoLoeschen holen knopf' b='Aktive Ebene l\u00f6schen' id='loescheBilder'  /><button class='imagePen holen knopf' b='Stift' id='stift' /><button class='imageRubber holen knopf' b='Radierer' id='radierer' /><button id='ebenenBunt' class='imageLayer'></button><button id='ebenenAnAus' class='imageLayerOnOff'></button>"+
ga+"<div id='ausgabe'></div><div id='info' >");$(a).append("<div id='qreator_svgbild'></div>");J=$("#layer2")[0].getContext("2d");J.strokeStyle="#ff0000";N=$("#layer3")[0];O=0;T=.03;ha=R=5;ta=[[[],[],""],[[25],[25],"#aaaaff"],[[],[50],"#aaaaff"],[[],[60,74,88,102,116],"#000000"]];na=0;qa=2;V="#000000";Aa=2;pa=[];rechtecke2=[];P=[];xa=10;qa=1;L=2;Z=0;k=2;da=0;Q=za=1;va=[];ma=oa=0;H=$("#layer1")[0].getContext("2d");sa=$("#layer3")[0].getContext("2d");z=[];bilder=[];p=[];X=[];for(a=0;a<l.length;a++)z[a]=
[],bilder[a]=[],p[a]=[];ba=!0;ja=fa=!1;ua=0;W=ea=!1;aa=[];window.PointerEvent?(N.addEventListener("pointerdown",function(a){"pen"!=a.pointerType&&"mouse"!=a.pointerType||q(a)}),N.addEventListener("pointermove",function(a){"pen"!=a.pointerType&&"mouse"!=a.pointerType||E(a)}),N.addEventListener("pointerup",function(a){"pen"!=a.pointerType&&"mouse"!=a.pointerType||u(a)})):(N.addEventListener("mousedown",q),N.addEventListener("mousemove",E),N.addEventListener("mouseup",u),N.addEventListener("touchstart",
e),N.addEventListener("touchmove",g),N.addEventListener("touchend",n));$("#ebenenBunt").click(function(){da=(da+1)%2;$(".layer").each(function(a){1==da&&1==I[a]?($(this).attr("style","background-color: "+la[a]+";"),$("#ebenenBunt").addClass("aktiv")):($(this).removeAttr("style"),$("#ebenenBunt").removeClass("aktiv"))});K(k,0,l.length-1,!0);w()});$("#ebenenAnAus").click(function(){for(var a=0,b=0;b<l.length;b++)1==I[b]&&a++;if(0<=a&&10>a)for(b=0;b<l.length;b++)I[b]=1;else for(b=0;b<l.length;b++)I[b]=
0;K(k,0,l.length-1,!0);w()});$("#zurueck").click(function(a){if(0<O){O--;if(0<=O){ba=!0;for(var b=X[O],c=0;c<b.length;c++)if(3==b[c].length){a=b[c][0];for(var f=b[c][1],d=b[c][2],e=0;e<p[a].length;e++)Math.abs(p[a][e])>=Math.abs(f)&&Math.abs(p[a][e])<=Math.abs(d)&&(p[a][e]=-p[a][e])}else if(2==b[c].length)for(a=b[c][0],f=b[c][1],e=0;e<p[a].length;e++)Math.abs(p[a][e])==Math.abs(f)&&(p[a][e]=-p[a][e],e=p[a].length)}K(k,0,l.length-1,!0)}});$("#vor").click(function(a){if(1==ba&&O<X.length){ba=!0;for(var b=
X[O],c=0;c<b.length;c++)if(3==b[c].length){a=b[c][0];for(var f=b[c][1],e=b[c][2],d=0;d<p[a].length;d++)Math.abs(p[a][d])>=Math.abs(f)&&Math.abs(p[a][d])<=Math.abs(e)&&(p[a][d]=-p[a][d])}else if(2==b[c].length)for(a=b[c][0],f=b[c][1],d=0;d<p[a].length;d++)Math.abs(p[a][d])==Math.abs(f)&&(p[a][d]=-p[a][d],d=p[a].length);O++;K(k,0,l.length-1,!0)}});$("#tbutton").click(function(a){a.preventDefault();a=$("#svgText").val();Ca.loadSVG(a)});$("#download").click(function(a){a.preventDefault();a=$("html").html();
window.open("data:text/csv,"+a)});$("#farben").change(function(a){a.preventDefault();V=$(this).val();Z=0;L=ca[qa];$("#stift").focus();w()});$("#dicken").change(function(a){a.preventDefault();a=parseInt($(this).prop("selectedIndex"));0==Z?qa=a:xa=a;L=ca[a];w()});$(".layer").click(function(a){a.preventDefault();a=parseInt($(this).attr("layer"));1==I[a]?k==a?I[a]=0:(k=a,null==z[k]&&(z[k]=[])):(I[a]=1,k=a,null==z[k]&&(z[k]=[]));K(l[k],0,l.length-1,!0);w()});$(".check").click(function(a){a=0;1==$(this).prop("checked")&&
(a=1);I[parseInt($(this).attr("value"))]=a;K(l[k],0,l.length-1,!0);w()});$("#radierer").click(function(a){a.preventDefault();Z=1;L=ca[xa];w()});$("#stift").click(function(){L=ca[qa];Z=0;w()});$("#raster").click(function(a){a.preventDefault();na=(na+1)%4;var b=ta[na][0];a=ta[na][1];var c=ta[na][2];z[0]=[];p[0]=[];new t(0,0);new t(0,0);if(0<b.length)for(var d=0;d<G;d+=b[b.length-1])for(var f=0;f<b.length;f++){var e=new t(d+b[f],0);var g=new t(d+b[f],F);g=[e,B.addiere(e,B.multipliziereMitSkalar(B.subtrahiere(g,
e),1/3)),B.addiere(e,B.multipliziereMitSkalar(B.subtrahiere(g,e),2/3)),g];z[0].push([g,B.findeRechtecksHuelle(g),0,2,c]);p[0].push(z[0].length)}if(0<a.length)for(b=0;b<F;b+=a[a.length-1])for(f=0;f<a.length;f++)e=new t(0,b+a[f]),g=new t(G,b+a[f]),g=[e,B.addiere(e,B.multipliziereMitSkalar(B.subtrahiere(g,e),1/3)),B.addiere(e,B.multipliziereMitSkalar(B.subtrahiere(g,e),2/3)),g],z[0].push([g,B.findeRechtecksHuelle(g),0,2,c]),p[0].push(z[0].length);K(l[k],0,l[k],!0)});$("#loeschenAktiv").click(function(a){a.preventDefault();
var b=H.createImageData(G,F);for(a=0;a<b.length;a+=4)b[a]=255,b[a+1]=255,b[a+2]=255,b[a+3]=0;H.putImageData(b,0,0);b=[];for(a=0;a<p[l[k]].length;a++)0<p[l[k]][a]&&(p[l[k]][a]=-p[l[k]][a],b.push([l[k],p[l[k]][a]]));X[O]=b;O++;S();K(k,0,k,!0)});$("#loescheBilder").click(function(){1==confirm("Sind Sie sicher, dass alle Bilder in der aktiven Ebene gel\u00f6scht werden sollen? Dieser Schritt kann nicht r\u00fcckg\u00e4ngig gemacht werden.")&&(bilder[l[k]]=[],K(k,0,k,!0))});$("#loeschen").click(function(a){a.preventDefault();
a=H.createImageData(G,F);for(var b=0;b<a.length;b+=4)a[b]=255,a[b+1]=255,a[b+2]=255,a[b+3]=0;H.putImageData(a,0,0);sa.putImageData(a,0,0);for(b=0;b<l.length;b++)z[l[b]]=[],p[l[b]]=[];X=[]});$("#knopf").click(function(a){a.preventDefault();QreatorBezier.showSVG()});w()};this.loescheBild=function(){for(var a=0;a<l.length;a++)0<bilder[a].length&&!1===bilder[a][bilder[a].length-1].behalten&&bilder[a].pop();K(k,0,k,!0)};this.ladeBild=function(a,b,d,f,h,c){var e=document.createElement("canvas");e.width=
f;e.height=h;e.getContext("2d").drawImage(a,0,0,f,h);a=e.toDataURL();b={img:null,ebene:k,nr:bilder[l[k]].length,data:a,breite:f,hoehe:h,x:b,y:d,behalten:c};for(d=0;d<l.length;d++)0<bilder[d].length&&!1===bilder[d][bilder[d].length-1].behalten&&bilder[d].pop();bilder[l[k]].push(b);K(k,0,k,!0)};this.insertImgAsSVG=function(a,b,d,f,h){$("#content").append("<div id='qreator_svgbild'></div>");$("#qreator_svgbild").html("<svg  width='100%' height='100%' viewBox='0 0 "+b+" "+b/a.width*a.height+"' hoehegesetzt='"+
b/a.width*a.height+"' breitegesetzt='"+b+"' heightoriginal='"+b/a.width*a.height+"' id='qreator_svgbild2' class='qreator_svg'><g fill='none' stroke-linecap='round' id='global'></g>");$("#qreator_svgbild2 #global").append("<g id='layer_2'></g>");$("#qreator_svgbild2 #global #layer_2").append(document.createElementNS("http://www.w3.org/2000/svg","image"));$("#qreator_svgbild2 #global #layer_2 image").last().attr("bildnr","0").attr("x","0").attr("y","0").attr("width",""+b).attr("height",""+b/a.width*
a.height).attr("xlink:href",""+a.src).attr("hoeheoriginal",""+b/a.width*a.height);$("#"+f).before("<div class='zeichenflaeche tshareElement zeichenflaecheKlick' >"+$("#qreator_svgbild").html()+"</div>"+h);$("#qreator_svgbild2").removeAttr("id");$("#qreator_svgbild").html("");$("#qreator_svgbild").remove()};this.showSVG=function(a){var b="",d=0;$("#qreator_svgbild").html("<svg  width='"+G+"' height='"+F+"' id='qreator_svgbild2' class='qreator_svg'><g fill='none' stroke-linecap='round' id='global'></g>");
for(var f=0;f<l.length;f++){var h=l[f];if(null!=z[h]&&0<z[h].length||null!=bilder[h]&&0<bilder[h].length){var c="";0==I[f]&&(c="visibility='hidden'");$("#qreator_svgbild2 #global").append("<g id='layer_"+h+"' "+c+"></g>");if(null!=bilder[h])for(c=0;c<bilder[h].length;c++){var e=bilder[h][c];$("#qreator_svgbild2 #global #layer_"+h).append(document.createElementNS("http://www.w3.org/2000/svg","image"));$("#qreator_svgbild2 #global #layer_"+h+" image").last().attr("bildnr",c).attr("x",""+e.x).attr("y",
""+e.y).attr("width",""+e.breite).attr("height",""+e.hoehe).attr("xlink:href",""+e.data);e.y+e.hoehe>d&&(d=e.y+e.hoehe)}if(null!=z[h]&&0<z[h].length){for(var c="",e=z[h][0][0][3],g="",n="",q="",E="",k=0;k<p[h].length;k++){var r=p[h][k];if(0<r){M=r-1;var r=z[h][M][0],t=z[h][M][4],w=z[h][M][3],C=z[h][M][1][3];C>d&&0<h&&(d=C);if(t!=g||w!=n)q=" stroke='"+t+"'",g=t,q+=" stroke-width='"+w+"'",n=w;0<q.length&&(0<c.length&&(b+="<path d='"+c+"' "+E+" />",e={x:-1,y:-1},c=""),E=q,q="");c=0<M&&r[0].x===e.x&&
r[0].y===e.y?c+(" c "+v(r[1].x-r[0].x,Q)+" "+v(r[1].y-r[0].y,Q)+" "+v(r[2].x-r[0].x,Q)+" "+v(r[2].y-r[0].y,Q)+" "+v(r[3].x-r[0].x,Q)+" "+v(r[3].y-r[0].y,Q)):c+(" M "+v(r[0].x,Q)+" "+v(r[0].y,Q)+" c "+v(r[1].x-r[0].x,Q)+" "+v(r[1].y-r[0].y,Q)+" "+v(r[2].x-r[0].x,Q)+" "+v(r[2].y-r[0].y,Q)+" "+v(r[3].x-r[0].x,Q)+" "+v(r[3].y-r[0].y,Q));e=z[h][M][0][3];2E3<c.length&&(b+="<path d='"+c+"' "+E+" />",e={x:-1,y:-1},c="",1E4<b.length&&($("#qreator_svgbild2 #global #layer_"+h).append(b),b=""),n=g="")}}0<c.length&&
(b+="<path d='"+c+"' "+E+" />");0<b.length&&($("#qreator_svgbild2 #global #layer_"+h).append(b),b="")}}}$("#qreator_svgbild svg").attr("height","100%").attr("width","100%").attr("heightoriginal",F).attr("hoehegesetzt",d).attr("breitegesetzt",G).attr("viewBox","0 0 "+G+"  "+d);$("#qreator_svgbild #qreator_svgbild2").removeAttr("id");$("#qreator_svgbild").html();$(wa).html("<div class='"+a+" tshareElement zeichenflaecheKlick' >"+$("#qreator_svgbild").html()+"</div>");$(wa).find("."+a).unwrap();$(Ba).html("")};
this.loadSVG=function(a){for(var b=0,d=0;d<I.length;d++)I[d]=1;console.log("Breite: "+$(a).attr("width")+", H\u00f6he: "+$(a).attr("height")+", Originalh\u00f6he: "+$(a).attr("heightoriginal"));d=$(a).attr("heightoriginal");void 0!=d&&($("#rahmen canvas").attr("height",parseInt(d)),F=parseInt(d));d=$(a).attr("breitegesetzt");void 0!=d&&($("#rahmen canvas").attr("width",parseInt(d)),G=parseInt(d));$(a).find(global);$(a).find("#global").find("g").each(function(){var a=parseInt($(this).attr("id").split("_")[1]);
z[a]=[];bilder[a]=[];b++;"hidden"==$(this).attr("visibility")&&(I[a]=0);$(this).find("image").each(function(){var b={data:$(this).attr("xlink:href"),x:parseInt($(this).attr("x")),y:parseInt($(this).attr("y")),breite:parseInt($(this).attr("width")),hoehe:parseInt($(this).attr("height")),ebene:a,nr:bilder[a].length};bilder[a].push(b)});$(this).find("path").each(function(){for(var b=$(this).attr("stroke"),c=parseInt($(this).attr("stroke-width")),e=$(this).attr("d").trim().split("M"),d=0;d<e.length;d++)if(""!=
e[d]){for(var f=e[d].split("c"),q=f[0].split(" "),k=[],u=0;u<q.length;u++)""!=q[u]&&k.push(q[u]);q=[];u=new t(parseFloat(k[0]),parseFloat(k[1]));q.push(u);for(k=1;k<f.length;k++){for(var r=f[k].split(" "),l=[],u=0;u<r.length;u++)""!=r[u]&&l.push(r[u]);if(6<=l.length)for(r=0;6>r;r+=2)u=new t(parseFloat(l[r])+q[0].x,parseFloat(l[r+1])+q[0].y),q.push(u);z[a].push([q,B.findeRechtecksHuelle(q),0,c,b]);p[a].push(z[a].length);4==q.length&&(u=new t(q[3].x,q[3].y),q=[],q.push(u))}}})});a=[];10>b&&(b=10);for(d=
0;d<b;d++)a[d]=d,null==I[d]&&(I[d]=1);for(d=0;d<I.length;d++);K(a[k],0,b-1,!0);w()};var B={initialisiere:function(a,b){this.ergebnis=[];this.epsilon=1E-11;this.TOLERANZ=1E-6;var d=null;this.fehler=b;this.punkte=[];for(var f=0;f<a.length;f++){var h=a[f];d&&h.x==d.x&&h.y==d.y||(this.punkte.push(h),d=h)}this.fehler=b},findeRechtecksHuelle:function(a){for(var b=a[0].x,d=b,f=a[0].y,h=f,c=1;c<a.length;c++)b>a[c].x?b=a[c].x:d<a[c].x&&(d=a[c].x),f>a[c].y?f=a[c].y:h<a[c].y&&(h=a[c].y);return[b-L,f-L,d+L,h+
L]},findeKonvexeHuelle:function(a){function b(a,b){var c=a.x-b.x;a=a.y-b.y;return c*c+a*a}function d(a,c,d){var e=(c.x-a.x)*(d.y-a.y)-(d.x-a.x)*(c.y-a.y);return 0<e?!0:0>e?!1:b(a,d)>b(a,c)}for(var f=a.length,h=[],c=0,e=1;e!=f;e++)a[e].y<a[c].y&&(c=e);var c=a[c],g=null;do{h.push(c);g=a[0];for(e=1;e!=f;e++)if(c.x===g.x&&c.y===g.y||d(c,g,a[e]))g=a[e];c=g}while(g.x!==h[0].x||g.y!==h[0].y);return h},parametrisiereKurve:function(a,b){for(var d=[0],f=a+1;f<=b;f++)d[f-a]=d[f-a-1]+this.berechneEntfernungIndex(f,
f-1);a=d[d.length-1];for(b=0;b<d.length;b++)d[b]/=a;return d},berechneEntfernungIndex:function(a,b){var d=this.punkte[a].x-this.punkte[b].x;a=this.punkte[a].y-this.punkte[b].y;return Math.sqrt(d*d+a*a)},berechneEntfernung:function(a,b){var d=a.x-b.x;a=a.y-b.y;return Math.sqrt(d*d+a*a)},normiere:function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y);0!==b&&(a.x/=b,a.y/=b);return a},multipliziereSkalar:function(a,b){return a.x*b.x+a.y*b.y},multipliziereMitSkalar:function(a,b){return{x:a.x*b,y:a.y*b}},addiere:function(a,
b){return{x:a.x+b.x,y:a.y+b.y}},subtrahiere:function(a,b){return{x:a.x-b.x,y:a.y-b.y}},approximiere:function(){var a=this.punkte,b=a.length;this.ergebnis=0<b?[[a[0]]]:[];1<b&&(C(2,"Anzahl der Punkte: "+b),this.approximiereKubisch(0,b-1,this.normiere(this.subtrahiere(a[1],a[0])),this.normiere(this.subtrahiere(a[b-2],a[b-1]))));return this.ergebnis},approximiereKubisch:function(a,b,d,f){if(1===b-a){a=this.punkte[a];b=this.punkte[b];var h=this.berechneEntfernung(a,b)/3;this.ergebnis.push([a,this.addiere(a,
this.multipliziereMitSkalar(this.normiere(d),h)),this.addiere(b,this.multipliziereMitSkalar(this.normiere(f),h)),b])}else{for(var c=this.parametrisiereKurve(a,b),e=Math.max(this.fehler,this.fehler*this.fehler),g=0;4>=g;g++){var n=this.findeBezierNaeherung(a,b,c,d,f);[].push(n);var k=this.findeGroesstenFehler(a,b,n,c);if(k.error<this.fehler){this.ergebnis.push(n);return}h=k.index;if(k.error>=e){C(3,"Maximaler Fehler: "+e+", gemessener Fehler: "+k.error);break}c=this.reparametrisiere(a,b,c,n);e=k.error}c=
this.subtrahiere(this.punkte[h-1],this.punkte[h]);e=this.subtrahiere(this.punkte[h],this.punkte[h+1]);c=this.normiere(this.multipliziereMitSkalar(this.addiere(c,e),.5));this.approximiereKubisch(a,h,d,c);this.approximiereKubisch(h,b,this.multipliziereMitSkalar(c,-1),f)}},findeBezierNaeherung:function(a,b,d,f,h){C(3,"findeBezierN\u00e4herung: "+a+" "+b);var c=this.epsilon,e=null,g=null,k=this.punkte[a],q=this.punkte[b],l=[[0,0],[0,0]],u=[0,0];b=b-a+1;for(var r=0;r<b;r++){var p=d[r],t=1-p,v=3*p*t,w=
t*t*t,t=v*t,v=v*p,z=p*p*p,p=this.multipliziereMitSkalar(this.normiere(f),t),B=this.multipliziereMitSkalar(this.normiere(h),v),w=this.subtrahiere(this.subtrahiere(this.punkte[a+r],this.multipliziereMitSkalar(k,w+t)),this.multipliziereMitSkalar(q,v+z));l[0][0]+=this.multipliziereSkalar(p,p);l[0][1]+=this.multipliziereSkalar(p,B);l[1][0]=l[0][1];l[1][1]+=this.multipliziereSkalar(B,B);u[0]+=this.multipliziereSkalar(p,w);u[1]+=this.multipliziereSkalar(B,w)}a=l[0][0]*l[1][1]-l[1][0]*l[0][1];if(Math.abs(a)>
c){var A=l[0][0]*u[1]-l[1][0]*u[0];u=(u[0]*l[1][1]-u[1]*l[0][1])/a;A/=a}else a=l[0][0]+l[0][1],l=l[1][0]+l[1][1],u=Math.abs(a)>c?A=u[0]/a:Math.abs(l)>c?A=u[1]/l:A=0;l=this.berechneEntfernung(k,q);c*=l;u<c||A<c?u=A=l/3:(c=this.subtrahiere(q,k),e=this.multipliziereMitSkalar(this.normiere(f),u),g=this.multipliziereMitSkalar(this.normiere(h),A),this.multipliziereSkalar(e,c)-this.multipliziereSkalar(g,c)>l*l&&(u=A=l/3,e=g=null));f=this.multipliziereMitSkalar(this.normiere(f),u);h=this.multipliziereMitSkalar(this.normiere(h),
A);null!=e&&(f=e);null!=g&&(h=g);return[k,this.addiere(k,f),this.addiere(q,h),q]},evaluiere:function(a,b,d){b=b.slice();for(var f=1;f<=a;f++)for(var h=0;h<=a-f;h++)b[h]=this.addiere(this.multipliziereMitSkalar(b[h],1-d),this.multipliziereMitSkalar(b[h+1],d));return b[0]},teile:function(a,b){for(var d=a.slice(),f=[],h=1;3>=h;h++)for(var c=0;c<=3-h;c++)d[c]=this.addiere(this.multipliziereMitSkalar(d[c],1-b),this.multipliziereMitSkalar(d[c+1],b)),f.push(d[c]);return[[a[0],f[0],f[3],f[5]],[f[5],f[4],
f[2],a[3]]]},zerlege:function(a,b,d){a=this.teile(a,b)[1];return this.teile(a,(d-b)/(1-b))[0]},findeGroesstenFehler:function(a,b,d,f){for(var h=Math.floor((b-a+1)/2),c=0,e=a+1;e<b;e++){var g=this.evaluiere(3,d,f[e-a]),g=this.subtrahiere(g,this.punkte[e]),g=g.x*g.x+g.y*g.y;g>=c&&(c=g,h=e)}return{error:c,index:h}},reparametrisiere:function(a,b,d,f){for(var h=a;h<=b;h++)d[h-a]=this.findeNullstelle(f,this.punkte[h],d[h-a]);return d},findeNullstelle:function(a,b,d){for(var f=[],h=[],c=0;2>=c;c++)f[c]=
this.multipliziereMitSkalar(this.subtrahiere(a[c+1],a[c]),3);for(c=0;1>=c;c++)h[c]=this.multipliziereMitSkalar(this.subtrahiere(f[c+1],f[c]),2);a=this.evaluiere(3,a,d);f=this.evaluiere(2,f,d);h=this.evaluiere(1,h,d);b=this.subtrahiere(a,b);h=this.multipliziereSkalar(f,f)+this.multipliziereSkalar(b,h);return Math.abs(h)<this.TOLERANZ?d:d-this.multipliziereSkalar(b,f)/h}}};
