var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(v,D,u){v!=Array.prototype&&v!=Object.prototype&&(v[D]=u.value)};$jscomp.getGlobal=function(v){return"undefined"!=typeof window&&window===v?v:"undefined"!=typeof global&&null!=global?global:v};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(v,D,u,A){if(D){u=$jscomp.global;v=v.split(".");for(A=0;A<v.length-1;A++){var C=v[A];C in u||(u[C]={});u=u[C]}v=v[v.length-1];A=u[v];D=D(A);D!=A&&null!=D&&$jscomp.defineProperty(u,v,{configurable:!0,writable:!0,value:D})}};$jscomp.polyfill("Array.prototype.fill",function(v){return v?v:function(v,u,A){var C=this.length||0;0>u&&(u=Math.max(0,C+u));if(null==A||A>C)A=C;A=Number(A);0>A&&(A=Math.max(0,C+A));for(u=Number(u||0);u<A;u++)this[u]=v;return this}},"es6","es3");
$jscomp.findInternal=function(v,D,u){v instanceof String&&(v=String(v));for(var A=v.length,C=0;C<A;C++){var Y=v[C];if(D.call(u,Y,C,v))return{i:C,v:Y}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(v){return v?v:function(v,u){return $jscomp.findInternal(this,v,u).v}},"es6","es3");
(function(){function v(u,A,C,Y,D){for(var U=Y,S,K=A+1;K<C;K++){var t=u[K];var k=u[A],N=u[C],G=k.x;k=k.y;var F=N.x-G,T=N.y-k;if(0!==F||0!==T){var R=((t.x-G)*F+(t.y-k)*T)/(F*F+T*T);1<R?(G=N.x,k=N.y):0<R&&(G+=F*R,k+=T*R)}F=t.x-G;T=t.y-k;t=F*F+T*T;t>U&&(S=K,U=t)}U>Y&&(1<S-A&&v(u,A,S,Y,D),D.push(u[S]),1<C-S&&v(u,S,C,Y,D))}function D(u,A,C){if(2>=u.length)return u;A=void 0!==A?A*A:1;if(C)var D=u;else{C=u[0];for(var ja=[C],U=1,S=u.length;U<S;U++){D=u[U];var K=D.x-C.x,t=D.y-C.y;K*K+t*t>A&&(ja.push(D),C=D)}C!==
D&&ja.push(D);D=ja}u=D.length-1;C=[D[0]];v(D,0,u,A,C);C.push(D[u]);return C}"function"===typeof define&&define.amd?define(function(){return D}):"undefined"!==typeof module?module.exports=D:"undefined"!==typeof self?self.simplify=D:window.simplify=D})();
var QreatorBezier=new function(){function v(){if(0==Z){$(".layer").removeClass("aktivBunt");$("#dicken option").prop("selected",!1).filter("[dicke='"+L+"']").prop("selected",!0);$(".layer").each(function(){$(this).removeClass("sichtbar")});$(".layer").each(function(){$(this).removeClass("unsichtbar")});$(".layer").removeClass("aktivLayer");for(var a=0;a<l.length;a++)1==I[a]?$("[layer='"+l[a]+"']").addClass("sichtbar"):$("[layer='"+l[a]+"']").addClass("unsichtbar");$(".layer").removeAttr("style");
$(".layer").each(function(a){1==fa&&1==I[a]&&($(this).attr("style","background-color: "+ka[a]+";"),a==k&&$(this).addClass("aktivBunt"))});1==I[k]&&$("[layer='"+l[k]+"']").addClass("aktivLayer");$("#radierer").removeClass("aktiv");$("#stift").addClass("aktiv")}else{$(".layer").removeClass("aktivBunt");$("#dicken option").prop("selected",!1).filter("[dicke='"+L+"']").prop("selected",!0);$(".layer").each(function(){$(this).removeClass("sichtbar")});$(".layer").each(function(){$(this).removeClass("unsichtbar")});
for(a=0;a<l.length;a++)1==I[a]?$("[layer='"+l[a]+"']").addClass("sichtbar"):$("[layer='"+l[a]+"']").addClass("unsichtbar");$(".layer").removeAttr("style");$(".layer").each(function(a){1==fa&&1==I[a]&&($(this).attr("style","background-color: "+ka[a]+";"),a==k&&$(this).addClass("aktivBunt"))});$(".layer").removeClass("aktivLayer");1==I[k]&&$("[layer='"+l[k]+"']").addClass("aktivLayer");$("#radierer").addClass("aktiv");$("#stift").removeClass("aktiv")}a=document.createElement("canvas");var c=L*window.devicePixelRatio;
a.width=c+3;a.height=c+3;var e=a.getContext("2d");e.beginPath();c=parseInt(c/2);0==c&&(c=1);e.arc(c+1,c+1,c,0,2*Math.PI);0==Z?(e.fillStyle=V,e.strokeStyle=V):(e.strokeStyle="rgba(255,200,200,1)",e.fillStyle="rgba(255,200,200,1)");e.stroke();e.fill();a="url("+a.toDataURL()+")"+(c-2)+" "+(c-2)+",auto";$("#layer3").css("cursor",a)}function D(a,c){a<=ta&&$("#ausgabe").append(c+"<br>")}function u(a,c){m=1;for(var e=0;e<c;e++)m*=10;return parseInt(a*m,10)/m}function A(a,c){if(0===aa.length){J.beginPath();
J.moveTo(a,c);na=a;la=c;oa=[];J.lineWidth=""+L;J.strokeStyle=V;J.lineCap="round";for(var e=0;e<R*ia;e++)oa[e]=0}else{J.lineTo(a,c);if(1===Z){J.lineWidth=""+L;J.strokeStyle="rgba(255,200,200,1)";e=a;na<a&&(e=na);var f=c,b=la;la<c&&(f=la,b=c);e-=L;var d=e+L;f-=L;b+=L;e=parseInt(e/(1*G/R),10);d=parseInt(d/(1*G/R),10);f=parseInt(f/(1*F/ia),10);for(b=parseInt(b/(1*F/ia),10);e<=d;e++)for(var h=f;h<=b;h++)oa[h*R+e]=1;na=a;la=c}J.stroke();J.beginPath();J.moveTo(a,c)}aa.push(new t(a,c))}function C(a){if(1==
I[k]){if(!0===ca){var c=a.targetTouches[0].pageX-N.offsetLeft-$("#rahmen")[0].offsetLeft;a=a.targetTouches[0].pageY-N.offsetTop-$("#rahmen")[0].offsetTop;A(c,a)}!0===W&&Y()}}function Y(){if(!0===W){rechtecke2=[];for(var a=0;a<R*ia;a++)1===oa[a]&&rechtecke2.push(a);ua=z.findeRechtecksHuelle(aa);if(0===Z){a=aa;if(1===a.length){var c=a[0].x,e=a[0].y;a=[];a.push(new t(c-1,e-1));a.push(new t(c+1,e-1));a.push(new t(c+1,e+1));a.push(new t(c-1,e+1))}c=!1;var f;var b=e=a[0].x;var d=f=a[0].y;for(var h=1;h<
a.length;h++){var g=a[h];g.x>b?b=g.x:g.x<e&&(e=g.x);g.y>d?d=g.y:g.y<f&&(f=g.y)}b=[e,f,b,d];f=parseInt(Math.max(b[2]-b[0],b[3]-b[1])/5,10);e=z.berechneEntfernung(a[0],a[a.length-1]);if(e<f){d=b[0];h=b[2];g=b[1];var n=b[3];f=1*(h-d)/(n-g);if(1.5>f&&.8<f){f=.25*(h-d+(n-g));d=new t(.5*(d+h),.5*(g+n));h=!0;for(b=0;b<a.length;b++)g=z.berechneEntfernung(d,a[b]),g<1.3*f&&g>.8*f||(h=!1,b=a.length);!0===h&&(erg=[],erg.push([new t(d.x,d.y+f),new t(d.x+.551915024494*f,d.y+f),new t(d.x+f,d.y+.551915024494*f),
new t(d.x+f,d.y)]),erg.push([new t(d.x+f,d.y),new t(d.x+f,d.y-.551915024494*f),new t(d.x+.551915024494*f,d.y-f),new t(d.x,d.y-f)]),erg.push([new t(d.x,d.y-f),new t(d.x-.551915024494*f,d.y-f),new t(d.x-f,d.y-.551915024494*f),new t(d.x-f,d.y)]),erg.push([new t(d.x-f,d.y),new t(d.x-f,d.y+.551915024494*f),new t(d.x-.551915024494*f,d.y+f),new t(d.x,d.y+f)]),c=!0)}else{f=parseInt(Math.max(b[2]-b[0],b[3]-b[1])/20,10);20<f&&(f=20);d=[];for(b=0;b<a.length;b++)d.push(new t(a[b].x,a[b].y));f=window.simplify(d,
f,!0);erg=[];if(3<f.length&&6>f.length){f[f.length-1]=f[0];if(5==f.length)for(b=0;b<f.length-1;b++)h=f[b],g=f[b+1],c=g.x-h.x,d=g.y-h.y,0!==d&&(h=1*d/c,.3>Math.abs(h)&&(3==b?(f[b+1].y=f[0].y,f[b].y=f[b+1].y):f[b+1].y=f[b].y)),0!==c&&(h=1*c/d,.3>Math.abs(h)&&(3==b?(f[b+1].x=f[0].x,f[b].x=f[b+1].x):f[b+1].x=f[b].x));for(b=0;b<f.length-1;b++)h=new t(f[b].x,f[b].y),g=new t(f[b+1].x,f[b+1].y),erg.push([h,z.addiere(h,z.multipliziereMitSkalar(z.subtrahiere(g,h),1/3)),z.addiere(h,z.multipliziereMitSkalar(z.subtrahiere(g,
h),2/3)),g]);c=!0}}}if(!1===c){f=parseInt(e/20,10);erg=[];e=a;b=f;f=0;d=!0;for(h=1;h<e.length-1;h++){g=e[h];n=e[0];var r=e[e.length-1];if(n.x===r.x)g=Math.abs(g.x-n.x);else{var E=new t(r.x-n.x,r.y-n.y),B=new t(g.x-n.x,g.y-n.y),p=Math.sqrt(E.x*E.x+E.y*E.y);B=(B.x*E.x+B.y*E.y)/p;B>p?(n=new t(r.x-g.x,r.y-g.y),g=Math.sqrt(n.x*n.x+n.y*n.y)):0>B?(n=new t(g.x-n.x,g.y-n.y),g=Math.sqrt(n.x*n.x+n.y*n.y)):(n=new t(n.x+B*E.x/p,n.y+B*E.y/p),g=new t(n.x-g.x,n.y-g.y),g=Math.sqrt(g.x*g.x+g.y*g.y))}g>f&&(f=g,f>b&&
(d=!1,h=e.length))}!0===d&&(h=a[0],g=a[a.length-1],c=g.x-h.x,d=g.y-h.y,0!==d&&Math.abs(1*d/c)<T&&(e=(h.y+g.y)/2,h.y=e,g.y=e),0!==c&&Math.abs(1*c/d)<T&&(e=(h.x+g.x)/2,h.x=e,g.x=e),erg=[[h,z.addiere(h,z.multipliziereMitSkalar(z.subtrahiere(g,h),1/3)),z.addiere(h,z.multipliziereMitSkalar(z.subtrahiere(g,h),2/3)),g]],c=!0)}z.initialisiere(a,ya);e=z.approximiere();if(0<a.length){f=J.createImageData(G,F);for(b=0;b<f.length;b+=4)f[b]=255,f[b+1]=255,f[b+2]=255,f[b+3]=0;J.putImageData(f,0,0)}f=w[l[k]].length;
for(b=0;b<e.length;b++)d=e[b],1===d.length?0==c&&(H.beginPath(),H.fillStyle=V,H.fillRect(d[0].x,d[0].y,1,1)):4===d.length&&(0==c&&(H.beginPath(),H.moveTo(d[0].x,d[0].y),H.strokeStyle=V,H.lineCap="round",H.lineWidth=""+L,H.bezierCurveTo(d[1].x,d[1].y,d[2].x,d[2].y,d[3].x,d[3].y),D(3,d[0].x+"/"+d[0].y+","+d[1].x+"/"+d[1].y+","+d[2].x+"/"+d[2].y+","+d[3].x+"/"+d[3].y),H.stroke()),w[l[k]].push([d,z.findeRechtecksHuelle(d),0,L,V]),q[l[k]].push(w[l[k]].length),ba=!1);0==ba&&S();X[O]=[[l[k],f+1,w[l[k]].length]];
O++;e=w[l[k]].length;if(1==c){for(b=0;b<erg.length;b++)d=erg[b],1===d.length?(H.beginPath(),H.fillStyle=V,H.fillRect(d[0].x,d[0].y,1,1)):4===d.length&&(H.beginPath(),H.moveTo(d[0].x,d[0].y),H.strokeStyle=V,H.lineCap="round",H.lineWidth=""+L,H.bezierCurveTo(d[1].x,d[1].y,d[2].x,d[2].y,d[3].x,d[3].y),D(3,d[0].x+"/"+d[0].y+","+d[1].x+"/"+d[1].y+","+d[2].x+"/"+d[2].y+","+d[3].x+"/"+d[3].y),H.stroke(),w[l[k]].push([d,z.findeRechtecksHuelle(d),0,L,V]),q[l[k]].push(w[l[k]].length),ba=!1);for(b=0;b<q[l[k]].length;b++)Math.abs(q[l[k]][b])>=
Math.abs(f+1)&&Math.abs(q[l[k]][b])<=Math.abs(e)&&(q[l[k]][b]=-q[l[k]][b]);X[O]=[[l[k],f+1,e],[l[k],e+1,w[l[k]].length]];O++}if(2<ta)for(b=0;b<a.length;b++)c=a[b].x,e=a[b].y,J.fillStyle="#ff0000",J.fillRect(c-2,e-2,5,5);aa=[];W=!1}else if(1===Z){c=[];for(a=0;a<l.length;a++)c[a]=0,a==l[k]&&(c[a]=1);e=[];for(b=0;b<c.length;b++)if(0<c[b])if(null!=w[b]&&0<w[b].length){P=[];if(rechtecke2.length<za)for(a=0;a<q[b].length;a++)0<q[b][a]&&(f=w[b][q[b][a]-1][1],!0===ja(ua,f)&&P.push(a));else for(a=0;a<q[b].length;a++)if(0<
q[b][a]){f=w[b][q[b][a]-1][1];d=!1;h=G/R;g=F/ia;for(n=0;n<rechtecke2.length;n++)x=parseInt(rechtecke2[n]%ia,10),y=parseInt(rechtecke2[n]/R,10),!0===ja(f,[x*h,y*g,x*h+h,y*g+g])&&(d=!0,n=rechtecke2.length);!0===d&&P.push(a)}d=J.getImageData(0,0,G,F);for(a=P.length-1;0<=a;a--){f=w[b][q[b][P[a]]-1][0];h=w[b][q[b][P[a]]-1][3];g=w[b][q[b][P[a]]-1][4];n=0;r=f[0].x;E=f[0].y;for(p=1;p<f.length;p++)n+=Math.sqrt((f[p].x-r)*(f[p].x-r)+(f[p].y-E)*(f[p].y-E));n=1/n*3;r=[];for(B=p=E=0;B<1+n;B+=n){1<B&&(B=1);var qa=
z.evaluiere(3,f,B);qa=4*(parseInt(qa.y,10)*G+parseInt(qa.x,10));200===d.data[qa+1]&&(r.push(E),p++);E++}if(3>E-p)e.push([b,-q[b][P[a]]]),q[b][P[a]]=-q[b][P[a]],ba=!1;else{ba=!1;for(p=r.length-2;0<=p;p--)2===r[p+1]-r[p]&&r.splice(p+1,0,r[p]+1);B=0;E=[];for(p=0;p<r.length;p++)1<r[p]-B&&(B=z.zerlege(f,B*n,(r[p]-1)*n),E.push(B)),B=r[p];0<r.length&&1>r[r.length-1]*n&&(B=z.teile(f,r[r.length-1]*n,1)[1],E.push(B));if(0<E.length){e.push([b,-q[b][P[a]]]);q[b][P[a]]=-q[b][P[a]];B=w[b].length;for(n=0;n<E.length;n++)w[b].push([E[n],
z.findeRechtecksHuelle(E[n]),1,h,g]),q[b].splice(P[a],0,w[b].length);e.push([b,B+1,w[b].length])}}}X[O]=e;O++;0==ba&&S();aa=[];f=J.createImageData(G,F);for(a=0;a<f.length;a+=4)f[a]=255,f[a+1]=255,f[a+2]=255,f[a+3]=0;J.putImageData(f,0,0);W=!1;K(k,0,k,!0)}else{aa=[];f=J.createImageData(G,F);for(a=0;a<f.length;a+=4)f[a]=255,f[a+1]=255,f[a+2]=255,f[a+3]=0;J.putImageData(f,0,0);W=!1}}}}function ja(a,c){return!(a[0]>c[2]||a[2]<c[0]||a[1]>c[3]||a[3]<c[1])}function U(a){if(1==I[k]){if(!0===ca){var c=a.pageX-
N.offsetLeft-$("#rahmen")[0].offsetLeft;a=a.pageY-N.offsetTop-$("#rahmen")[0].offsetTop;A(c,a)}!0===W&&Y()}}function S(){for(var a=O;a<X.length;a++)X.splice(a,1)}function K(a,c,e,f){for(var b=0,d=0,h=0;h<l.length;h++)for(var g=0;g<bilder[h].length;g++)1==I[h]&&null==bilder[h][g].img&&d++;g=J.createImageData(G,F);for(h=0;h<g.length;h+=4)g[h]=255,g[h+1]=255,g[h+2]=255,g[h+3]=0;J.putImageData(g,0,0);c<=a&&H.putImageData(g,0,0);e>a&&ra.putImageData(g,0,0);for(h=c;h<=e;h++){c=H;h>a&&(c=ra);var n=l[h];
if(1==I[n]){if(1==f&&null!=bilder[n])for(g=0;g<bilder[n].length;g++){this.bild=bilder[n][g];var r=new Image;null==bilder[n][g].img?(r.onload=function(){b++;b==d&&K(k,0,l.length-1,!0)},bilder[n][g].img=r,r.width=bilder[n][g].breite,r.height=bilder[n][g].hoehe,r.x=bilder[n][g].x,r.y=bilder[n][g].y,r.src=bilder[n][g].data):(c.drawImage(bild.img,bild.x,bild.y,bild.breite,bild.hoehe),1==fa&&(c.strokeStyle=ka[n],c.beginPath(),c.lineWidth="5",c.rect(bild.x,bild.y,bild.breite,bild.hoehe),c.moveTo(bild.x,
bild.y),c.lineTo(bild.x+bild.breite,bild.y+bild.hoehe),c.moveTo(bild.x+bild.breite,bild.y),c.lineTo(bild.x,bild.y+bild.hoehe),c.stroke()))}if(null!=w[n])for(g=0;g<q[n].length;g++)0<q[n][g]&&(r=w[n][q[n][g]-1][0],c.beginPath(),c.moveTo(r[0].x,r[0].y),c.strokeStyle=w[n][q[n][g]-1][4],1==fa&&(c.strokeStyle=ka[n]),c.lineCap="round",c.lineWidth=""+w[n][q[n][g]-1][3],c.bezierCurveTo(r[1].x,r[1].y,r[2].x,r[2].y,r[3].x,r[3].y),c.stroke())}}}function t(a,c){this.x=a;this.y=c}var k,N,G,F,T,R,ia,sa,ma,pa,V,
za,oa,P,L,ya,Q,ua,na,la,Z,J,H,ra,w,ha,ta,ca,W,aa,va,wa,Aa,q,X,O,ba;var ka="#00ff00 #FF0000 #0000FF #008000 #FFA500 #EB4DFF #808000 #808080 #ADD8E6 #62FFFF #00FF00 #00FFFF #FF00FF".split(" ");var da="";for(var M=0;M<ka.length;M++);da+="<input id='farben'  type='color' value='#000000' list='color' /><datalist id='color'><option>#000000</option><option>#ff0000</option><option>#0000ff</option><option>#00ff00</option><option>#ffff00</option><option>#008000</option><option>#a52a2a</option><option>#ffa500</option><option>#999999</option><option>#00ffff</option></datalist>";
var ea=[1,2,3,4,5,6,8,10,12,20,30,40,50];da+="<span vertical-align='center'><select id='dicken'>";for(M=0;M<ea.length;M++)da=1==M?da+("<option selected dicke='"+ea[M]+"'>"+ea[M]+"</option> "):da+("<option dicke='"+ea[M]+"'>"+ea[M]+"</option> ");da+="</select>";var fa=0,xa=[0,1,2,3,4,5,6,7,8,9];var I=[1,1,1,1,1,1,1,1,1,1];var l=[0,1,2,3,4,5,6,7,8,9];for(M=0;M<xa.length;M++)da+="<button class='layer' layer='"+xa[M]+"' >"+xa[M]+"</button>";da+="</span>";var Ba=this;this.holeBezier=function(a,c){z.initialisiere(a,
c);return z.approximiere()};this.init=function(a,c,e,f,b,d){function h(a){a.preventDefault();aa=[];p="touch";ca=!0;W=!1;ha=!0;C(a)}function g(a){a.preventDefault();!0===ha&&1==ca&&"touch"==p&&C(a)}function n(a){a.preventDefault();!0===ha&&"touch"==p&&(W=!0,ha=ca=!1,C(a))}function r(a){a.preventDefault();aa=[];ca=!0;ha=W=!1;p=a.pointerType;"pen"!=a.pointerType&&"mouse"!=a.pointerType&&"touch"==a.pointerType&&(ha=!0);U(a)}function E(a){a.preventDefault();1==ca&&a.pointerType==p&&U(a)}function B(a){a.preventDefault();
p==a.pointerType&&(W=!0,ha=ca=!1,U(a))}I=[1,1,1,1,1,1,1,1,1,1];G=c;F=e;va=a;Aa=f;$(a).html("<div id='rahmen' style='position: relative;'> <canvas id='layer1' width='"+G+"' height='"+F+"' style='z-index: 0;'></canvas> <canvas id='layer2'  width='"+G+"' height='"+F+"' style='position: absolute; left: 0; top: 0; z-index: 1;'></canvas><canvas id='layer3' width='"+G+"' height='"+F+"' style='position: absolute; left: 0; top: 0; z-index: 2;'></canvas> </div>");$(f).html("<br> <button class='imageUndo holen knopf'  id='zurueck'  /><button class='imageRedo holen knopf'  id='vor'  /><button class='imageRaster holen knopf' b='Raster \u00e4ndern' id='raster'  /><button  class='bild imageDelete holen knopf' b='Aktive Ebene l\u00f6schen' id='loeschenAktiv' alt='aktive Ebene leeren' /><button id='bild' class='imageFotoNeu' alt='neuesFoto'></button><button class='imageFotoLoeschen holen knopf' b='Aktive Ebene l\u00f6schen' id='loescheBilder'  /><button class='imagePen holen knopf' b='Stift' id='stift' /><button class='imageRubber holen knopf' b='Radierer' id='radierer' /><button id='ebenenBunt' class='imageLayer'></button><button id='ebenenAnAus' class='imageLayerOnOff'></button>"+
da+"<div id='ausgabe'></div><div id='info' >");$(a).append("<div id='qreator_svgbild'></div>");J=$("#layer2")[0].getContext("2d");J.strokeStyle="#ff0000";N=$("#layer3")[0];O=0;T=.03;ia=R=5;sa=[[[],[],""],[[25],[25],"#aaaaff"],[[],[50],"#aaaaff"],[[],[60,74,88,102,116],"#000000"]];ma=0;pa=2;V="#000000";za=2;oa=[];rechtecke2=[];P=[];wa=10;pa=1;L=2;Z=0;k=2;fa=0;Q=ya=1;ua=[];la=na=0;H=$("#layer1")[0].getContext("2d");ra=$("#layer3")[0].getContext("2d");w=[];bilder=[];q=[];X=[];for(a=0;a<l.length;a++)w[a]=
[],bilder[a]=[],q[a]=[];ba=!0;ha=!1;ta=0;W=ca=!1;aa=[];$("#farben").spectrum();window.PointerEvent?(N.addEventListener("pointerdown",function(a){r(a)}),N.addEventListener("pointermove",function(a){E(a)}),N.addEventListener("pointerup",function(a){B(a)})):(N.addEventListener("mousedown",r),N.addEventListener("mousemove",E),N.addEventListener("mouseup",B),N.addEventListener("touchstart",h),N.addEventListener("touchmove",g),N.addEventListener("touchend",n));var p="";$("#ebenenBunt").click(function(){fa=
(fa+1)%2;$(".layer").each(function(a){1==fa&&1==I[a]?($(this).attr("style","background-color: "+ka[a]+";"),$("#ebenenBunt").addClass("aktiv")):($(this).removeAttr("style"),$("#ebenenBunt").removeClass("aktiv"))});K(k,0,l.length-1,!0);v()});$("#ebenenAnAus").click(function(){for(var a=0,b=0;b<l.length;b++)1==I[b]&&a++;if(0<=a&&10>a)for(b=0;b<l.length;b++)I[b]=1;else for(b=0;b<l.length;b++)I[b]=0;K(k,0,l.length-1,!0);v()});$("#zurueck").click(function(a){if(0<O){O--;if(0<=O){ba=!0;a=X[O];for(var b=
0;b<a.length;b++)if(3==a[b].length)for(var c=a[b][0],d=a[b][1],f=a[b][2],e=0;e<q[c].length;e++)Math.abs(q[c][e])>=Math.abs(d)&&Math.abs(q[c][e])<=Math.abs(f)&&(q[c][e]=-q[c][e]);else if(2==a[b].length)for(c=a[b][0],d=a[b][1],e=0;e<q[c].length;e++)Math.abs(q[c][e])==Math.abs(d)&&(q[c][e]=-q[c][e],e=q[c].length)}K(k,0,l.length-1,!0)}});$("#vor").click(function(a){if(1==ba&&O<X.length){ba=!0;a=X[O];for(var b=0;b<a.length;b++)if(3==a[b].length)for(var c=a[b][0],d=a[b][1],f=a[b][2],e=0;e<q[c].length;e++)Math.abs(q[c][e])>=
Math.abs(d)&&Math.abs(q[c][e])<=Math.abs(f)&&(q[c][e]=-q[c][e]);else if(2==a[b].length)for(c=a[b][0],d=a[b][1],e=0;e<q[c].length;e++)Math.abs(q[c][e])==Math.abs(d)&&(q[c][e]=-q[c][e],e=q[c].length);O++;K(k,0,l.length-1,!0)}});$("#tbutton").click(function(a){a.preventDefault();a=$("#svgText").val();Ba.loadSVG(a)});$("#download").click(function(a){a.preventDefault();a=$("html").html();window.open("data:text/csv,"+a)});$("#farben").change(function(a){a.preventDefault();V=$(this).val();Z=0;L=ea[pa];$("#stift").focus();
v()});$("#dicken").change(function(a){a.preventDefault();a=parseInt($(this).prop("selectedIndex"));0==Z?pa=a:wa=a;L=ea[a];v()});$(".layer").click(function(a){a.preventDefault();a=parseInt($(this).attr("layer"));1==I[a]?k==a?I[a]=0:(k=a,null==w[k]&&(w[k]=[])):(I[a]=1,k=a,null==w[k]&&(w[k]=[]));K(l[k],0,l.length-1,!0);v()});$(".check").click(function(a){a=0;1==$(this).prop("checked")&&(a=1);I[parseInt($(this).attr("value"))]=a;K(l[k],0,l.length-1,!0);v()});$("#radierer").click(function(a){a.preventDefault();
Z=1;L=ea[wa];v()});$("#stift").click(function(){L=ea[pa];Z=0;v()});$("#raster").click(function(a){a.preventDefault();ma=(ma+1)%4;var b=sa[ma][0];a=sa[ma][1];var c=sa[ma][2];w[0]=[];q[0]=[];new t(0,0);new t(0,0);if(0<b.length)for(var d=0;d<G;d+=b[b.length-1])for(var f=0;f<b.length;f++){var e=new t(d+b[f],0);var g=new t(d+b[f],F);e=[e,z.addiere(e,z.multipliziereMitSkalar(z.subtrahiere(g,e),1/3)),z.addiere(e,z.multipliziereMitSkalar(z.subtrahiere(g,e),2/3)),g];w[0].push([e,z.findeRechtecksHuelle(e),
0,2,c]);q[0].push(w[0].length)}if(0<a.length)for(b=0;b<F;b+=a[a.length-1])for(f=0;f<a.length;f++)e=new t(0,b+a[f]),g=new t(G,b+a[f]),e=[e,z.addiere(e,z.multipliziereMitSkalar(z.subtrahiere(g,e),1/3)),z.addiere(e,z.multipliziereMitSkalar(z.subtrahiere(g,e),2/3)),g],w[0].push([e,z.findeRechtecksHuelle(e),0,2,c]),q[0].push(w[0].length);K(l[k],0,l[k],!0)});$("#loeschenAktiv").click(function(a){a.preventDefault();var b=H.createImageData(G,F);for(a=0;a<b.length;a+=4)b[a]=255,b[a+1]=255,b[a+2]=255,b[a+3]=
0;H.putImageData(b,0,0);b=[];for(a=0;a<q[l[k]].length;a++)0<q[l[k]][a]&&(q[l[k]][a]=-q[l[k]][a],b.push([l[k],q[l[k]][a]]));X[O]=b;O++;S();K(k,0,k,!0)});$("#loescheBilder").click(function(){1==confirm("Sind Sie sicher, dass alle Bilder in der aktiven Ebene gel\u00f6scht werden sollen? Dieser Schritt kann nicht r\u00fcckg\u00e4ngig gemacht werden.")&&(bilder[l[k]]=[],K(k,0,k,!0))});$("#loeschen").click(function(a){a.preventDefault();a=H.createImageData(G,F);for(var b=0;b<a.length;b+=4)a[b]=255,a[b+
1]=255,a[b+2]=255,a[b+3]=0;H.putImageData(a,0,0);ra.putImageData(a,0,0);for(b=0;b<l.length;b++)w[l[b]]=[],q[l[b]]=[];X=[]});$("#knopf").click(function(a){a.preventDefault();QreatorBezier.showSVG()});v()};this.loescheBild=function(){for(var a=0;a<l.length;a++)0<bilder[a].length&&!1===bilder[a][bilder[a].length-1].behalten&&bilder[a].pop();K(k,0,k,!0)};this.ladeBild=function(a,c,e,f,b,d){var h=document.createElement("canvas");h.width=f;h.height=b;h.getContext("2d").drawImage(a,0,0,f,b);a=h.toDataURL();
c={img:null,ebene:k,nr:bilder[l[k]].length,data:a,breite:f,hoehe:b,x:c,y:e,behalten:d};for(e=0;e<l.length;e++)0<bilder[e].length&&!1===bilder[e][bilder[e].length-1].behalten&&bilder[e].pop();bilder[l[k]].push(c);K(k,0,k,!0)};this.insertImgAsSVG=function(a,c,e,f,b){$("#content").append("<div id='qreator_svgbild'></div>");$("#qreator_svgbild").html("<svg  width='100%' height='100%' viewBox='0 0 "+c+" "+c/a.width*a.height+"' hoehegesetzt='"+c/a.width*a.height+"' breitegesetzt='"+c+"' heightoriginal='"+
c/a.width*a.height+"' id='qreator_svgbild2' class='qreator_svg'><g fill='none' stroke-linecap='round' id='global'></g>");$("#qreator_svgbild2 #global").append("<g id='layer_2'></g>");$("#qreator_svgbild2 #global #layer_2").append(document.createElementNS("http://www.w3.org/2000/svg","image"));$("#qreator_svgbild2 #global #layer_2 image").last().attr("bildnr","0").attr("x","0").attr("y","0").attr("width",""+c).attr("height",""+c/a.width*a.height).attr("xlink:href",""+a.src).attr("hoeheoriginal",""+
c/a.width*a.height);$("#"+f).before("<div class='zeichenflaeche tshareElement zeichenflaecheKlick' >"+$("#qreator_svgbild").html()+"</div>"+b);$("#qreator_svgbild2").removeAttr("id");$("#qreator_svgbild").html("");$("#qreator_svgbild").remove()};this.showSVG=function(a){var c="",e=0;$("#qreator_svgbild").html("<svg  width='"+G+"' height='"+F+"' id='qreator_svgbild2' class='qreator_svg'><g fill='none' stroke-linecap='round' id='global'></g>");for(var f=0;f<l.length;f++){var b=l[f];if(null!=w[b]&&0<
w[b].length||null!=bilder[b]&&0<bilder[b].length){var d="";0==I[f]&&(d="visibility='hidden'");$("#qreator_svgbild2 #global").append("<g id='layer_"+b+"' "+d+"></g>");if(null!=bilder[b])for(d=0;d<bilder[b].length;d++){var h=bilder[b][d];$("#qreator_svgbild2 #global #layer_"+b).append(document.createElementNS("http://www.w3.org/2000/svg","image"));$("#qreator_svgbild2 #global #layer_"+b+" image").last().attr("bildnr",d).attr("x",""+h.x).attr("y",""+h.y).attr("width",""+h.breite).attr("height",""+h.hoehe).attr("xlink:href",
""+h.data);h.y+h.hoehe>e&&(e=h.y+h.hoehe)}if(null!=w[b]&&0<w[b].length){d="";h=w[b][0][0][3];for(var g="",n="",r="",E="",k=0;k<q[b].length;k++){var p=q[b][k];if(0<p){M=p-1;p=w[b][M][0];var t=w[b][M][4],v=w[b][M][3],z=w[b][M][1][3];z>e&&0<b&&(e=z);if(t!=g||v!=n)r=" stroke='"+t+"'",g=t,r+=" stroke-width='"+v+"'",n=v;0<r.length&&(0<d.length&&(c+="<path d='"+d+"' "+E+" />",h={x:-1,y:-1},d=""),E=r,r="");d=0<M&&p[0].x===h.x&&p[0].y===h.y?d+(" c "+u(p[1].x-p[0].x,Q)+" "+u(p[1].y-p[0].y,Q)+" "+u(p[2].x-p[0].x,
Q)+" "+u(p[2].y-p[0].y,Q)+" "+u(p[3].x-p[0].x,Q)+" "+u(p[3].y-p[0].y,Q)):d+(" M "+u(p[0].x,Q)+" "+u(p[0].y,Q)+" c "+u(p[1].x-p[0].x,Q)+" "+u(p[1].y-p[0].y,Q)+" "+u(p[2].x-p[0].x,Q)+" "+u(p[2].y-p[0].y,Q)+" "+u(p[3].x-p[0].x,Q)+" "+u(p[3].y-p[0].y,Q));h=w[b][M][0][3];2E3<d.length&&(c+="<path d='"+d+"' "+E+" />",h={x:-1,y:-1},d="",1E4<c.length&&($("#qreator_svgbild2 #global #layer_"+b).append(c),c=""),n=g="")}}0<d.length&&(c+="<path d='"+d+"' "+E+" />");0<c.length&&($("#qreator_svgbild2 #global #layer_"+
b).append(c),c="")}}}$("#qreator_svgbild svg").attr("height","100%").attr("width","100%").attr("heightoriginal",F).attr("hoehegesetzt",e).attr("breitegesetzt",G).attr("viewBox","0 0 "+G+"  "+e);$("#qreator_svgbild #qreator_svgbild2").removeAttr("id");$("#qreator_svgbild").html();$(va).html("<div class='"+a+" tshareElement zeichenflaecheKlick' >"+$("#qreator_svgbild").html()+"</div>");$(va).find("."+a).unwrap();$(Aa).html("")};this.loadSVG=function(a){for(var c=0,e=0;e<I.length;e++)I[e]=1;console.log("Breite: "+
$(a).attr("width")+", H\u00f6he: "+$(a).attr("height")+", Originalh\u00f6he: "+$(a).attr("heightoriginal"));e=$(a).attr("heightoriginal");void 0!=e&&($("#rahmen canvas").attr("height",parseInt(e)),F=parseInt(e));e=$(a).attr("breitegesetzt");void 0!=e&&($("#rahmen canvas").attr("width",parseInt(e)),G=parseInt(e));$(a).find("#global").find("g").each(function(){var a=parseInt($(this).attr("id").split("_")[1]);w[a]=[];bilder[a]=[];c++;"hidden"==$(this).attr("visibility")&&(I[a]=0);$(this).find("image").each(function(){var b=
{data:$(this).attr("xlink:href"),x:parseInt($(this).attr("x")),y:parseInt($(this).attr("y")),breite:parseInt($(this).attr("width")),hoehe:parseInt($(this).attr("height")),ebene:a,nr:bilder[a].length};bilder[a].push(b)});$(this).find("path").each(function(){for(var b=$(this).attr("stroke"),c=parseInt($(this).attr("stroke-width")),e=$(this).attr("d").trim().split("M"),f=0;f<e.length;f++)if(""!=e[f]){for(var n=e[f].split("c"),r=n[0].split(" "),k=[],B=0;B<r.length;B++)""!=r[B]&&k.push(r[B]);r=[];B=new t(parseFloat(k[0]),
parseFloat(k[1]));r.push(B);for(k=1;k<n.length;k++){var p=n[k].split(" "),l=[];for(B=0;B<p.length;B++)""!=p[B]&&l.push(p[B]);if(6<=l.length)for(p=0;6>p;p+=2)B=new t(parseFloat(l[p])+r[0].x,parseFloat(l[p+1])+r[0].y),r.push(B);w[a].push([r,z.findeRechtecksHuelle(r),0,c,b]);q[a].push(w[a].length);4==r.length&&(B=new t(r[3].x,r[3].y),r=[],r.push(B))}}})});a=[];10>c&&(c=10);for(e=0;e<c;e++)a[e]=e,null==I[e]&&(I[e]=1);for(e=0;e<I.length;e++);K(a[k],0,c-1,!0);v()};var z={initialisiere:function(a,c){this.ergebnis=
[];this.epsilon=1E-11;this.TOLERANZ=1E-6;var e=null;this.fehler=c;this.punkte=[];for(var f=0;f<a.length;f++){var b=a[f];e&&b.x==e.x&&b.y==e.y||(this.punkte.push(b),e=b)}this.fehler=c},findeRechtecksHuelle:function(a){for(var c=a[0].x,e=c,f=a[0].y,b=f,d=1;d<a.length;d++)c>a[d].x?c=a[d].x:e<a[d].x&&(e=a[d].x),f>a[d].y?f=a[d].y:b<a[d].y&&(b=a[d].y);return[c-L,f-L,e+L,b+L]},findeKonvexeHuelle:function(a){function c(a,b){var c=a.x-b.x;a=a.y-b.y;return c*c+a*a}function e(a,b,d){var e=(b.x-a.x)*(d.y-a.y)-
(d.x-a.x)*(b.y-a.y);return 0<e?!0:0>e?!1:c(a,d)>c(a,b)}for(var f=a.length,b=[],d=0,h=1;h!=f;h++)a[h].y<a[d].y&&(d=h);d=a[d];var g=null;do{b.push(d);g=a[0];for(h=1;h!=f;h++)if(d.x===g.x&&d.y===g.y||e(d,g,a[h]))g=a[h];d=g}while(g.x!==b[0].x||g.y!==b[0].y);return b},parametrisiereKurve:function(a,c){for(var e=[0],f=a+1;f<=c;f++)e[f-a]=e[f-a-1]+this.berechneEntfernungIndex(f,f-1);a=e[e.length-1];for(c=0;c<e.length;c++)e[c]/=a;return e},berechneEntfernungIndex:function(a,c){var e=this.punkte[a].x-this.punkte[c].x;
a=this.punkte[a].y-this.punkte[c].y;return Math.sqrt(e*e+a*a)},berechneEntfernung:function(a,c){var e=a.x-c.x;a=a.y-c.y;return Math.sqrt(e*e+a*a)},normiere:function(a){var c=Math.sqrt(a.x*a.x+a.y*a.y);0!==c&&(a.x/=c,a.y/=c);return a},multipliziereSkalar:function(a,c){return a.x*c.x+a.y*c.y},multipliziereMitSkalar:function(a,c){return{x:a.x*c,y:a.y*c}},addiere:function(a,c){return{x:a.x+c.x,y:a.y+c.y}},subtrahiere:function(a,c){return{x:a.x-c.x,y:a.y-c.y}},approximiere:function(){var a=this.punkte,
c=a.length;this.ergebnis=0<c?[[a[0]]]:[];1<c&&(D(2,"Anzahl der Punkte: "+c),this.approximiereKubisch(0,c-1,this.normiere(this.subtrahiere(a[1],a[0])),this.normiere(this.subtrahiere(a[c-2],a[c-1]))));return this.ergebnis},approximiereKubisch:function(a,c,e,f){if(1===c-a){a=this.punkte[a];c=this.punkte[c];var b=this.berechneEntfernung(a,c)/3;this.ergebnis.push([a,this.addiere(a,this.multipliziereMitSkalar(this.normiere(e),b)),this.addiere(c,this.multipliziereMitSkalar(this.normiere(f),b)),c])}else{for(var d=
this.parametrisiereKurve(a,c),h=Math.max(this.fehler,this.fehler*this.fehler),g=0;4>=g;g++){var n=this.findeBezierNaeherung(a,c,d,e,f);[].push(n);var k=this.findeGroesstenFehler(a,c,n,d);if(k.error<this.fehler){this.ergebnis.push(n);return}b=k.index;if(k.error>=h){D(3,"Maximaler Fehler: "+h+", gemessener Fehler: "+k.error);break}d=this.reparametrisiere(a,c,d,n);h=k.error}d=this.subtrahiere(this.punkte[b-1],this.punkte[b]);h=this.subtrahiere(this.punkte[b],this.punkte[b+1]);d=this.normiere(this.multipliziereMitSkalar(this.addiere(d,
h),.5));this.approximiereKubisch(a,b,e,d);this.approximiereKubisch(b,c,this.multipliziereMitSkalar(d,-1),f)}},findeBezierNaeherung:function(a,c,e,f,b){D(3,"findeBezierN\u00e4herung: "+a+" "+c);var d=this.epsilon,h=null,g=null,k=this.punkte[a],r=this.punkte[c],l=[[0,0],[0,0]],q=[0,0];c=c-a+1;for(var p=0;p<c;p++){var t=e[p],u=1-t,v=3*t*u,w=u*u*u;u*=v;v*=t;var z=t*t*t;t=this.multipliziereMitSkalar(this.normiere(f),u);var C=this.multipliziereMitSkalar(this.normiere(b),v);w=this.subtrahiere(this.subtrahiere(this.punkte[a+
p],this.multipliziereMitSkalar(k,w+u)),this.multipliziereMitSkalar(r,v+z));l[0][0]+=this.multipliziereSkalar(t,t);l[0][1]+=this.multipliziereSkalar(t,C);l[1][0]=l[0][1];l[1][1]+=this.multipliziereSkalar(C,C);q[0]+=this.multipliziereSkalar(t,w);q[1]+=this.multipliziereSkalar(C,w)}a=l[0][0]*l[1][1]-l[1][0]*l[0][1];if(Math.abs(a)>d){var A=l[0][0]*q[1]-l[1][0]*q[0];q=(q[0]*l[1][1]-q[1]*l[0][1])/a;A/=a}else a=l[0][0]+l[0][1],l=l[1][0]+l[1][1],q=Math.abs(a)>d?A=q[0]/a:Math.abs(l)>d?A=q[1]/l:A=0;l=this.berechneEntfernung(k,
r);d*=l;q<d||A<d?q=A=l/3:(d=this.subtrahiere(r,k),h=this.multipliziereMitSkalar(this.normiere(f),q),g=this.multipliziereMitSkalar(this.normiere(b),A),this.multipliziereSkalar(h,d)-this.multipliziereSkalar(g,d)>l*l&&(q=A=l/3,h=g=null));f=this.multipliziereMitSkalar(this.normiere(f),q);b=this.multipliziereMitSkalar(this.normiere(b),A);null!=h&&(f=h);null!=g&&(b=g);return[k,this.addiere(k,f),this.addiere(r,b),r]},evaluiere:function(a,c,e){c=c.slice();for(var f=1;f<=a;f++)for(var b=0;b<=a-f;b++)c[b]=
this.addiere(this.multipliziereMitSkalar(c[b],1-e),this.multipliziereMitSkalar(c[b+1],e));return c[0]},teile:function(a,c){for(var e=a.slice(),f=[],b=1;3>=b;b++)for(var d=0;d<=3-b;d++)e[d]=this.addiere(this.multipliziereMitSkalar(e[d],1-c),this.multipliziereMitSkalar(e[d+1],c)),f.push(e[d]);return[[a[0],f[0],f[3],f[5]],[f[5],f[4],f[2],a[3]]]},zerlege:function(a,c,e){a=this.teile(a,c)[1];return this.teile(a,(e-c)/(1-c))[0]},findeGroesstenFehler:function(a,c,e,f){for(var b=Math.floor((c-a+1)/2),d=0,
h=a+1;h<c;h++){var g=this.evaluiere(3,e,f[h-a]);g=this.subtrahiere(g,this.punkte[h]);g=g.x*g.x+g.y*g.y;g>=d&&(d=g,b=h)}return{error:d,index:b}},reparametrisiere:function(a,c,e,f){for(var b=a;b<=c;b++)e[b-a]=this.findeNullstelle(f,this.punkte[b],e[b-a]);return e},findeNullstelle:function(a,c,e){for(var f=[],b=[],d=0;2>=d;d++)f[d]=this.multipliziereMitSkalar(this.subtrahiere(a[d+1],a[d]),3);for(d=0;1>=d;d++)b[d]=this.multipliziereMitSkalar(this.subtrahiere(f[d+1],f[d]),2);a=this.evaluiere(3,a,e);f=
this.evaluiere(2,f,e);b=this.evaluiere(1,b,e);c=this.subtrahiere(a,c);b=this.multipliziereSkalar(f,f)+this.multipliziereSkalar(c,b);return Math.abs(b)<this.TOLERANZ?e:e-this.multipliziereSkalar(c,f)/b}}};
