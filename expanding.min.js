!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Expanding=t()}(this,function(){"use strict"
function e(e,t){e.parentNode.insertBefore(t,e),t.appendChild(e)}function t(e,t){for(var n in t)e.style[n]=t[n]}function n(e,t){t=t||{}
var n=document.createEvent("Event")
n.initEvent(e,!0,t.cancelable===!0),n.data=null!=t.data?t.data:{}
var i=null!=t.target?t.target:document
i.dispatchEvent(n)}function i(e){this.element=e,this._eventListeners={}}function l(e){return m?parseFloat(e)+3+"px":e}function r(){this.element=document.createElement("pre"),this.element.className="expanding-clone",this.innerElement=document.createElement("span"),this.element.appendChild(this.innerElement),this.element.appendChild(document.createElement("br"))}function o(t){this.element=a(),this.textarea=new i(t),this.textareaClone=new r,this.textarea.oldStyleAttribute=t.getAttribute("style"),s.call(this),u.call(this),e(t,this.element),this.element.appendChild(this.textareaClone.element)
var n=this.update.bind(this)
this.textarea.on(f,n),this.textarea.on("change",n),this.update()}function a(){var e=document.createElement("div")
return e.className="expanding-wrapper",e.style.position="relative",e}function s(){var e={margin:0,webkitBoxSizing:"border-box",mozBoxSizing:"border-box",boxSizing:"border-box",width:"100%"}
this.textareaClone.style({minHeight:this.textarea.element.offsetHeight+"px"}),this.textareaClone.style(e),this.textarea.style(e)}function u(){this.textareaClone.style(this.textareaClone.styles(this.textarea.element)),this.textarea.style(this.textarea.styles())}var d=window.navigator.userAgent,h=function(){var e=-1
if("Microsoft Internet Explorer"===window.navigator.appName){var t=RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})")
null!==t.exec(d)&&(e=parseFloat(RegExp.$1))}return e}(),p="oninput"in document.createElement("input")&&9!==h,f=p?"input":"keyup",m=/iPad|iPhone|iPod/.test(d)&&!window.MSStream
i.prototype={style:function(e){t(this.element,e)},styles:function(){return{position:"absolute",top:0,left:0,height:"100%",resize:"none",overflow:"auto"}},value:function(e){return 0===arguments.length?this.element.value.replace(/\r\n/g,"\n"):void(this.element.value=e)},on:function(e,t){this.element.addEventListener(e,t),this._eventListeners[e]=t},off:function(e){if(0===arguments.length)for(var t in this._eventListeners)this.off(t)
else this.element.removeEventListener(e,this._eventListeners[e]),delete this._eventListeners[e]},destroy:function(){this.element.setAttribute("style",this.oldStyleAttribute||""),this.off()}}
var c={borderBottomWidth:null,borderLeftWidth:null,borderRightWidth:null,borderTopWidth:null,direction:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStyle:null,fontWeight:null,letterSpacing:null,lineHeight:null,maxHeight:null,paddingBottom:null,paddingLeft:l,paddingRight:l,paddingTop:null,textAlign:null,textDecoration:null,textTransform:null,wordBreak:null,wordSpacing:null,wordWrap:null}
return r.prototype={value:function(e){return 0===arguments.length?this.innerElement.textContent:void(this.innerElement.textContent=e)},style:function(e){t(this.element,e)},styles:function(e){var t=e.getAttribute("wrap"),n={display:"block",border:"0 solid",visibility:"hidden",overflowX:"off"===t?"scroll":"hidden",whiteSpace:"off"===t?"pre":"pre-wrap"},i=window.getComputedStyle(e)
for(var l in c){var r=c[l],o=i[l]
n[l]=r?r(o):o}return n}},o.prototype={update:function(){this.textareaClone.value(this.textarea.value()),n("expanding:update",{target:this.textarea.element})},refresh:function(){u.call(this)},destroy:function(){this.element.removeChild(this.textareaClone.element),this.element.parentNode.insertBefore(this.textarea.element,this.element),this.element.parentNode.removeChild(this.element),this.textarea.destroy()}},o})
