var saveAs=saveAs||function(e){"use strict"
if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},a=t.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in a,r=function(e){var t=new MouseEvent("click")
e.dispatchEvent(t)},s=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),o=e.webkitRequestFileSystem,l=e.requestFileSystem||o||e.mozRequestFileSystem,d=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},c="application/octet-stream",h=0,p=500,u=function(t){var a=function(){"string"==typeof t?n().revokeObjectURL(t):t.remove()}
e.chrome?a():setTimeout(a,p)},m=function(e,t,n){t=[].concat(t)
for(var a=t.length;a--;){var i=e["on"+t[a]]
if("function"==typeof i)try{i.call(e,n||e)}catch(r){d(r)}}},b=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},v=function(t,d,p){p||(t=b(t))
var v,f,g,$=this,k=t.type,w=!1,y=function(){m($,"writestart progress write writeend".split(" "))},I=function(){if(f&&s&&"undefined"!=typeof FileReader){var a=new FileReader
return a.onloadend=function(){var e=a.result
f.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),$.readyState=$.DONE,y()},a.readAsDataURL(t),void($.readyState=$.INIT)}if((w||!v)&&(v=n().createObjectURL(t)),f)f.location.href=v
else{var i=e.open(v,"_blank")
void 0==i&&s&&(e.location.href=v)}$.readyState=$.DONE,y(),u(v)},x=function(e){return function(){return $.readyState!==$.DONE?e.apply(this,arguments):void 0}},C={create:!0,exclusive:!1}
return $.readyState=$.INIT,d||(d="download"),i?(v=n().createObjectURL(t),void setTimeout(function(){a.href=v,a.download=d,r(a),y(),u(v),$.readyState=$.DONE})):(e.chrome&&k&&k!==c&&(g=t.slice||t.webkitSlice,t=g.call(t,0,t.size,c),w=!0),o&&"download"!==d&&(d+=".download"),(k===c||o)&&(f=e),l?(h+=t.size,void l(e.TEMPORARY,h,x(function(e){e.root.getDirectory("saved",C,x(function(e){var n=function(){e.getFile(d,C,x(function(e){e.createWriter(x(function(n){n.onwriteend=function(t){f.location.href=e.toURL(),$.readyState=$.DONE,m($,"writeend",t),u(e)},n.onerror=function(){var e=n.error
e.code!==e.ABORT_ERR&&I()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=$["on"+e]}),n.write(t),$.abort=function(){n.abort(),$.readyState=$.DONE},$.readyState=$.WRITING}),I)}),I)}
e.getFile(d,{create:!1},x(function(e){e.remove(),n()}),x(function(e){e.code===e.NOT_FOUND_ERR?n():I()}))}),I)}),I)):void I())},f=v.prototype,g=function(e,t,n){return new v(e,t,n)}
return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=b(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(f.abort=function(){var e=this
e.readyState=e.DONE,m(e,"abort")},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,g)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content)
"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),$(function(){function e(){$(".tshareElement").each(function(){var e=parseInt($(this).attr("sichtbarkeit"))
0==c[e]?$(this).attr("visibility","hidden"):$(this).removeAttr("visibility")})}function t(){$("#header").removeClass("menuLeft").removeClass("menuRight").removeClass("menuTop").removeClass("menuBottom"),$("#header").addClass("left"),$("#content").removeClass("moveLeft").removeClass("moveDown").removeClass("moveUp"),$("#content").addClass("moveLeft"),$("[position='left']").hide(),$("[position='right']").show(),$("[position='top']").show(),$("[position='bottom']").show(),$(".auswahl").removeClass("selectMenu"),$(".auswahl").addClass("selectMenu")}function n(){$("#header").removeClass("menuLeft").removeClass("menuRight").removeClass("menuTop").removeClass("menuBottom"),$("#content").removeClass("moveLeft").removeClass("moveDown").removeClass("moveUp"),$("#header").addClass("menuRight"),$("[position='right']").hide(),$("[position='left']").show(),$("[position='top']").show(),$("[position='bottom']").show(),$(".auswahl").removeClass("selectMenu"),$(".auswahl").addClass("selectMenu")}function a(){$("#header").removeClass("menuLeft").removeClass("menuRight").removeClass("menuTop").removeClass("menuBottom"),$("#header").addClass("menuTop"),$("#content").removeClass("moveLeft").removeClass("moveDown").removeClass("moveUp"),$("#content").addClass("moveDown"),$("[position='top']").hide(),$("[position='right']").show(),$("[position='left']").show(),$("[position='bottom']").show(),$(".auswahl").removeClass("selectMenu")}function i(){$("#header").removeClass("menuLeft").removeClass("menuRight").removeClass("menuTop").removeClass("menuBottom"),$("#header").addClass("menuBottom"),$("#content").removeClass("moveLeft").removeClass("moveDown").removeClass("moveUp"),$("#content").addClass("moveUp"),$("[position='bottom']").hide(),$("[position='top']").show(),$("[position='right']").show(),$("[position='left']").show(),$(".auswahl").removeClass("selectMenu")}function r(e){if(1==$("#rahmen").length&&0==$(".transparent").length){var t=e.clipboardData.items
if(!t)return void console.log("fileList is null.")
for(var n=0;n<t.length;n++){var a=t[n]
if(a.type.startsWith("image/")){var i=a.getAsFile(),r=new FileReader
r.onload=function(e){g=new Image,g.onload=function(){k=0,w=0,y=!0,this.width>this.height&&(y=!1),1==y?(w=Math.min(u,this.height),u>w&&(w=u),k=this.width*w/this.height,k>p&&(w=w*p/k,k=p,y=!1)):(k=Math.min(p,this.width),p>k&&(k=p),w=this.height*k/this.width,w>u&&(k=k*u/w,w=u,y=!0)),$("body").append("<div class='transparent'></div>"),$(".transparent").append("<div class='fenster'><div id='parameter'></div><button id='abbrechenBild'>Abbrechen</button></div>"),0==y?$(".fenster #parameter").html("<br>Breite (in Prozent von Abschnittsbreite): <input typ='breite' class='parameter' type='range' min='0' max='100' value='"+parseInt(100*k/p)+"'></input><span id='breite'>"+parseInt(100*k/p)+"</span>%, Höhe:<span id='hoehe'>"+parseInt(100*w/u)+"</span>%"):$(".fenster #parameter").html("<br>Höhe (in Prozent von Abschnittshöhe): <input typ='hoehe' class='parameter' type='range' min='0' max='100' value='"+parseInt(100*w/u)+"'></input><span id='hoehe'>"+parseInt(100*w/u)+"</span>%, Breite: <span id='breite'>"+parseInt(100*k/p)+"</span>%"),$(".fenster #parameter").append("<br>x-Position links oben:  <input typ='x' class='parameter' type='range' min='0' max='100' value='0'></input><span id='xpos'>0</span><button class='mittig' typ='links'>linksbündig</button><button class='mittig' typ='xmitte'>horizontal zentrieren</button><button class='mittig' typ='rechts'>rechtsbündig</button>"),$(".fenster #parameter").append("<br>y-Position links oben:  <input typ='y' class='parameter' type='range' min='0' max='100' value='0'></input><span id='ypos'>0</span><button class='mittig' typ='oben'>oben bündig</button><button class='mittig' typ='ymitte'>vertikal zentrieren</button><button class='mittig' typ='unten'>unten bündig</button>"),$(".fenster #parameter").append("<br><button id='bildEinfuegen'>Bild einfügen</button>"),QreatorBezier.ladeBild(g,0,0,k,w,!1)},g.src=e.target.result},r.onerror=function(e){console.log(e.target.error.name)},r.onprogress=function(e){console.log(e.loaded,e.total)},r.readAsDataURL(i)}}}}function s(){var e=new Date,t=e.getMonth()+1,n=""
10>t&&(n="0"),n+=t
var a=e.getDate(),i=""
10>a&&(i="0"),i+=a
var r="",s=e.getHours()
10>s&&(r="0"),r+=s
var o="",l=e.getMinutes()
10>l&&(o="0"),o+=l
var d="",c=e.getSeconds()
return 10>c&&(d="0"),d+=c,""+(1900+e.getYear())+n+i+"_"+r+o+d}function o(){for(var e="",t=[".katex .delimsizing.size1",".katex .delimsizing.size2",".katex .delimsizing.size3",".katex .delimsizing.size4",".katex .delimsizing.mult .delim-size1 > span",".katex .delimsizing.mult .delim-size4 > span",".katex .op-symbol.small-op",".katex .op-symbol.large-op",".katex .mathit",".katex .mathbf",".katex .amsrm",".katex .mathbb",".katex .mathcal",".katex .mathfrak",".katex .mathtt",".katex .mathscr",".katex .mathsf",".katex .mainit"],n=["KaTeX_Size1","KaTeX_Size2","KaTeX_Size3","KaTeX_Size4","KaTeX_Size1","KaTeX_Size4","KaTeX_Size1","KaTeX_Size2","KaTeX_Main","KaTeX_Main","KaTeX_Math","KaTeX_Main","KaTeX_AMS","KaTeX_AMS","KaTeX_Caligraphic","KaTeX_Fraktur","KaTeX_Typewriter","KaTeX_Script","KaTeX_SansSerif","KaTeX_Main"],a=0;a<t.length;a++){var i=0
$(t[a]).each(function(){i++}),t[a]=i}for(var r=new Set,a=0;a<t.length;a++)t[a]>0&&r.add(n[a])
var s=Array.from(r)
console.log("Schriften: ")
for(var o="",l=$("#katexStyle").text().split("/* KateX_Fonts END */"),n=l[0].split("/**/"),a=0;a<s.length;a++)for(var d=s[a],a=0;a<n.length;a++)-1!=n[a].indexOf(d)&&(o+=n[a].trim())
return e=o+l[1]}function l(){var e=""
return d(),$(".markieren").each(function(){if($(this).hasClass("aktiv")){var t=$(this).parent().prev(),n=""
t.hasClass("markdown")?n="markdown":t.hasClass("zeichenflaeche")?n="zeichenflaeche zeichenflaecheKlick":t.hasClass("datei")&&(n="datei"),e+="<div class='tshareElement "+n+"'>"+$(this).parent().prev().html()+"</div>"+z}}),I=e,e=h+e}function d(){1==bearbeitungAn&&("zeichenflaeche"==v?(QreatorBezier.showSVG("zeichenflaeche"),bearbeitungAn=!1):"markdown"==v&&(Textabschnitt.zeigeMarkdown("#markdownTable"),bearbeitungAn=!1,$("#markdown").removeAttr("id")))}a()
var c=[1,0,1,1,1,1,1,1,1,1],h="JEIF?EJFM?jmEHl§/87h78§FHLhl§F",p=998,u=701,m=998,b=701
bearbeitungAn=!1
for(var v="",f="",g="",k=0,w=0,y=!1,I="",x="<select class='sichtbarkeit'>",C=0;10>C;C++)x+=0==C?"<option selected sichtbarkeit='"+C+"'>"+C+"</option> ":"<option sichtbarkeit='"+C+"'>"+C+"</option> "
x+="</select>",$(document).on("change",".sichtbarkeit",function(t){t.preventDefault()
var n=parseInt($(this).prop("selectedIndex"))
$(this).parent().prev().attr("sichtbarkeit",n),e()}),x=""
var z="<span><button class='loeschen imageTonne oben'></button><button class='markieren imageSelect oben'></button><button class='kopiereAbschnitt imageCopy oben'></button><button class='einfuegen imageInsertInternal unten'></button><button class='einfuegenClipboard imagePaste unten'></button>"+x+"</span><button class='neueZeichenflaeche imageJournal unten' ></button><button class='pdf imagePDF unten'></button><button class='markdownEinfuegen imageNew unten'></button><button class='bildEinfuegen imageFotoNeu unten'></button>"
$(document).ready(function(){new Clipboard("#kopieren",{text:function(e){return l()}})}),$(document).ready(function(){new Clipboard(".kopiereAbschnitt",{text:function(e){d()
var t="",n="",a=$(e).parent().prev()
return a.hasClass("markdown")?n="markdown":a.hasClass("zeichenflaeche")?n="zeichenflaeche zeichenflaecheKlick":a.hasClass("datei")&&(n="datei"),t="<div class='tshareElement "+n+"'>"+$(e).parent().prev().html()+"</div>"+z,I=t,h+t}})}),window.addEventListener("beforeunload",function(e){var t="Eventuelle Änderungen am Dokument könnten verloren gehen!"
return e.returnValue=t,t}),document.addEventListener("paste",r,!1),$("#speichern").click(function(){d(),$("body").append("<div class='transparent'></div>")
var e=f
""==f&&(e="Notiz"),$(".transparent").append("<div class='fenster'>Speichern der aktuellen Datei (Zeitstempel und Endung werden angehängt)<br>Dateiname: <input type='text' id='dateiname' value='"+e+"'></input><input type='checkbox' id='checkEditor'>Editor in Datei einbetten</input><br><button id='speichereDatei'>Speichern</button><button id='abbrechen'>Abbrechen</button></div>")}),$("#menuansicht").click(function(){$("body").append("<div class='transparent'></div>"),$(".transparent").append("<div class='fenster'>Position des Menüs wählen:<br><button class='menu-position' position='left'>Menü links</button><button class='menu-position' position='top'>Menü oben</button><button class='menu-position' position='bottom'>Menü unten</button><button class='menu-position' position='right'>Menü rechts</button><br><button id='abbrechen'>Abbrechen</button></div>"),$(".fenster").append('<p>Info:<br><div>Icons made by <a href="http://www.freepik.com" title="Freepik">Freepik</a>, <a href="http://www.flaticon.com/authors/yannick" title="Yannick">Yannick</a>, <a href="http://www.flaticon.com/authors/picol" title="Picol">Picol</a>, <a href="http://www.flaticon.com/authors/situ-herrera" title="Situ Herrera">Situ Herrera</a>, <a href="http://www.flaticon.com/authors/freepik">freepik</a>, <a href="http://www.flaticon.com/authors/egor-rumyantsev" title="Egor Rumyantsev">Egor Rumyantsev</a>, <a href="http://fontawesome.io/" title="Dave Gandy">Dave Gandy</a> from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a>             is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0">CC BY 3.0</a></div>')}),$(document).on("click","#speichereDatei",function(){var e=$("#dateiname").val(),t=$("#checkEditor").prop("checked")
if(null!=e){""==e&&(e="Notiz")
var n="PHNjcmlwdD5mdW5jdGlvbiBuZXh0TGF5ZXIoZXZ0KXt2YXIgYSA9ZXZlbnQudGFyZ2V0O3ZhciB6YWVobGVyPTA7Zm9yICh2YXIgaT0wO2k8MTA7aSsrKXt2YXIgZWxlbWVudD1hLmdldEVsZW1lbnRCeUlkKCdsYXllcl8nK2kpO2lmIChlbGVtZW50IT1udWxsJiZlbGVtZW50LmdldEF0dHJpYnV0ZSgndmlzaWJpbGl0eScpPT0naGlkZGVuJyl7ZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3Zpc2liaWxpdHknLCd2aXNpYmxlJyk7ICBicmVhazt9emFlaGxlcisrO31pZiAoemFlaGxlcj09MTApe2ZvciAodmFyIGk9MDtpPDEwO2krKyl7dmFyIGVsZW1lbnQ9YS5nZXRFbGVtZW50QnlJZCgnbGF5ZXJfJytpKTtpZiAoZWxlbWVudCE9bnVsbCkge2VsZW1lbnQuc2V0QXR0cmlidXRlKCd2aXNpYmlsaXR5JywnaGlkZGVuJyk7ICB9IH0gZm9yICh2YXIgaT0wO2k8MTA7aSsrKXsgdmFyIGVsZW1lbnQ9YS5nZXRFbGVtZW50QnlJZCgnbGF5ZXJfJytpKTtpZiAoZWxlbWVudCE9bnVsbCYmZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3Zpc2liaWxpdHknKT09J2hpZGRlbicpeyBlbGVtZW50LnNldEF0dHJpYnV0ZSgndmlzaWJpbGl0eScsJ3Zpc2libGUnKTticmVhazsgfX19fTwvc2NyaXB0Pg=="
f=e
var a=s()
if($(".transparent").remove(),1==t){var i=new Blob(["<!DOCTYPE html><html>"+$("html").html()+"</html>"],{type:"text/html;charset=utf-8"})
saveAs(i,e+"_Editor_"+a+".html")}else{var r="",l=0
$(".tshareElement").each(function(){$(this).hasClass("zeichenflaeche")?r+="<div class='zeichenflaeche tshareElement' onClick='nextLayer(this)'>"+$(this).html()+"</div>\n":$(this).hasClass("markdown")?(r+="<div class='markdown tshareElement'>"+$(this).html()+"</div>\n",l++):$(this).hasClass("datei")&&(r+="<div class='datei tshareElement'>"+$(this).html()+"</div>\n")})
var d=""
l>0&&(d=o())
var i=new Blob(["<!DOCTYPE html><head><meta name='viewport' charset='utf-8' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />"+window.atob(n)+"<style>"+d+"</style><html>"+r+"</html>"],{type:"text/html;charset=utf-8"})
saveAs(i,e+"_"+a+".html")}}}),$("#druckansicht").click(function(){d()
var e="PHNjcmlwdD5mdW5jdGlvbiBuZXh0TGF5ZXIoZXZ0KXt2YXIgYSA9ZXZlbnQudGFyZ2V0O3ZhciB6YWVobGVyPTA7Zm9yICh2YXIgaT0wO2k8MTA7aSsrKXt2YXIgZWxlbWVudD1hLmdldEVsZW1lbnRCeUlkKCdsYXllcl8nK2kpO2lmIChlbGVtZW50IT1udWxsJiZlbGVtZW50LmdldEF0dHJpYnV0ZSgndmlzaWJpbGl0eScpPT0naGlkZGVuJyl7ZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3Zpc2liaWxpdHknLCd2aXNpYmxlJyk7ICBicmVhazt9emFlaGxlcisrO31pZiAoemFlaGxlcj09MTApe2ZvciAodmFyIGk9MDtpPDEwO2krKyl7dmFyIGVsZW1lbnQ9YS5nZXRFbGVtZW50QnlJZCgnbGF5ZXJfJytpKTtpZiAoZWxlbWVudCE9bnVsbCkge2VsZW1lbnQuc2V0QXR0cmlidXRlKCd2aXNpYmlsaXR5JywnaGlkZGVuJyk7ICB9IH0gZm9yICh2YXIgaT0wO2k8MTA7aSsrKXsgdmFyIGVsZW1lbnQ9YS5nZXRFbGVtZW50QnlJZCgnbGF5ZXJfJytpKTtpZiAoZWxlbWVudCE9bnVsbCYmZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3Zpc2liaWxpdHknKT09J2hpZGRlbicpeyBlbGVtZW50LnNldEF0dHJpYnV0ZSgndmlzaWJpbGl0eScsJ3Zpc2libGUnKTticmVhazsgfX19fTwvc2NyaXB0Pg==",t=0,n=""
$(".tshareElement").each(function(){$(this).hasClass("zeichenflaeche")?n+="<div class='zeichenflaeche' onClick='nextLayer(this)'>"+$(this).html()+"</div>\n":$(this).hasClass("markdown")?(n+="<div class='markdown'>"+$(this).html()+"</div>\n",t++):$(this).hasClass("datei")&&(n+="<div class='datei'>"+$(this).html()+"</div>\n")})
var a=""
t>0&&(a=o())
var i=window.open()
i.document.open(),i.document.write("<!DOCTYPE html><head>"+window.atob(e)+"<style>"+a+"</style></head><html>"+n+"</html>"),i.document.close()}),$(document).on("click",".menu-position",function(){var e=$(this).attr("position")
switch($(".transparent").remove(),e){case"left":t()
break
case"right":n()
break
case"bottom":i()
break
default:a()}}),$(document).on("click",".neueZeichenflaeche",function(){d(),$(this).next().next().next().after("<div class='zeichenflaeche' id='zeichnung'></div>"+z),bearbeitungAn=!0,v="zeichenflaeche",p=m,u=b,QreatorBezier.init("#zeichnung",m,b,"#menu",!0)}),$(document).on("click",".markieren",function(){d(),$(this).toggleClass("aktiv")}),$("#markiereAlle").click(function(){d()
var e=0
$(".tshareElement").each(function(){e++})
var t=0
$(".markieren").each(function(){$(this).hasClass("aktiv")&&t++}),e>t?$(".markieren").each(function(){$(this).removeClass("aktiv").addClass("aktiv")}):$(".markieren").each(function(){$(this).removeClass("aktiv")})}),$("#auswahlLoeschen").click(function(){var e=confirm("Sind Sie sicher, dass die gewählten Abschnitte inklusive aller Inhalte entfernt werden soll? Dieser Schritt kann nicht rückgängig gemacht werden!")
1==e&&(d(),$(".markieren").each(function(){$(this).hasClass("aktiv")&&($(this).parent().prev().remove(),$(this).parent().next().remove(),$(this).parent().next().remove(),$(this).parent().next().remove(),$(this).parent().next().remove(),$(this).parent().remove())}))}),$(document).on("click",".einfuegenClipboard",function(){$(this).parent().next().next().next().next().after("<div id='einsetzen'></div>"),$("body").append("<div class='transparent'></div>"),$(".transparent").append("<div class='fenster'><p>Bitte fügen Sie den Inhalt des Clipboards in das Textfeld ein (z. B. per Strg+V) und drücken Sie dann den Knopf \"Einfügen\"</p><textarea id='clipboardExtern' required='required' ></textArea><button id='clipboardExternEinfuegen'>Einfügen in Dokument</button><button id='abbrechen'>Abbrechen</button></div>")}),$(document).on("click","#clipboardExternEinfuegen",function(){var e=$("#clipboardExtern").val()
if(e.startsWith(h)){var t=confirm("Sind Sie sicher, dass dieser Abschnitt eingefügt werden soll? Dieser Schritt kann nicht mehr rückgängig gemacht werden!")
1==t&&(d(),$("#einsetzen").after(e.substring(h.length,e.length)),$(".transparent").remove(),$("#einsetzen").remove())}else window.alert("Der Inhalt hat das falsche Format. Es können nur Inhalte aus Tshare eingefügt werden.")}),$(document).on("click",".einfuegen",function(){d(),$(this).parent().next().next().next().next().after(I)}),$(document).on("click",".markdownEinfuegen",function(){d(),$(this).next().after("<div class='markdown tshareElement' id='markdown'></div>"+z),bearbeitungAn=!0,v="markdown",Textabschnitt.init("#markdown","#menu")}),$(document).on("click",".bildEinfuegen",function(){d(),$(this).after("<div id='einsetzen'></div>"),$("body").append("<div class='transparent'></div>"),$(".transparent").append("<div class='fenster'><input id='bildInput' type='file' required='required' ></input><button id='abbrechen'>Abbrechen</button><div id='parameter'></div></div>"),$("#bildInput").trigger("click")}),$(document).on("change","#bildInput",function(){var e=$("#bildInput")[0].files,t=e[0],n=new FileReader
n.onload=function(e){$("#bildInput").hide(),$("#abbrechen").hide().after("<div id='ladeInfo'>Bitte warten ...</div>")
window.btoa(unescape(encodeURIComponent(e.target.result)))
"image"==t.type.split("/")[0]&&($("#einsetzen").before("<div class='datei tshareElement'><img id='bildNeu' ></img></div>"+z),$("#bildNeu")[0].src=e.target.result,$("#bildNeu").removeAttr("id")),$(".transparent").remove(),$("#einsetzen").remove()},n.readAsDataURL(t)}),$(document).on("click",".downloadFile",function(){var e=$(this).attr("data"),t=Base64Binary.decodeArrayBuffer(e)
new Blob([t],{type:$(this).attr("datatype")})
saveAs([t],$(this).attr("filename"))}),$(document).on("click",".pdf",function(){d(),$(this).next().next().after("<div id='einsetzen'></div>"),$("body").append("<div class='transparent'></div>"),$(".transparent").append("<div class='fenster'><input id='pdfInput' type='file' accept='application/pdf' required='required' ></input><button id='abbrechen'>Abbrechen</button><div id='parameter'></div></div>"),$("#pdfInput").trigger("click")}),$(document).on("change","#pdfInput",function(){var e=$("#pdfInput")[0].files,t=e[0],n=new FileReader
n.onload=function(e){function n(e){that.seitenZaehler++
var t=e.getViewport(1),s=2*p/t.width
t=e.getViewport(s)
var o=document.createElement("canvas")
o.style.display="block"
var l=o.getContext("2d")
o.height=t.height,o.width=t.width
var d=e.render({canvasContext:l,viewport:t}),c=d._internalRenderTask.callback
d._internalRenderTask.callback=function(e){c.call(this,e),this.seitennummer=this.pageNumber
for(var t=this,n={r:255,g:255,b:255},a=l.getImageData(0,0,o.width,o.height),r=0,s=a.data.length;s>r;r+=4){var d=a.data[r],h=a.data[r+1],m=a.data[r+2]
d==n.r&&h==n.g&&m==n.b&&(a.data[r+3]=0)}l.putImageData(a,0,0),g=new Image,g.onload=function(){k=o.width,w=o.height,console.log(this.src),that.zaehler++,QreatorBezier.insertImgAsSVG(this,p,u,"einsetzen"+t.seitennummer,z),console.log("Zähler "+that.zaehler+" Seitennummer: "+t.seitennummer),that.zaehler==i&&($(".einsetzen").remove(),$(".transparent").remove())},g.src=o.toDataURL()},a++,null!==r&&i>=a&&r.getPage(a).then(n)}if(t.name.endsWith(".pdf")){$("#pdfInput").hide(),$("#abbrechen").hide().after("<div id='ladeInfo'>Bitte warten ...</div>"),PDFJS.disableWorker=!0
var a=1,i=0,r=null
this.zaehler=0,this.seitenZaehler=0,this.bildLadeZaehler=0,that=this,PDFJS.getDocument(e.target.result).then(function(e){r=e,i=e.numPages
for(var t=0;i>t;t++)$("#einsetzen").before("<div class='einsetzen' id='einsetzen"+(t+1)+"'></div>")
$("#einsetzen").remove(),e.getPage(1).then(n)})}},n.readAsDataURL(t)}),$(document).on("click",".zeichenflaecheKlick",function(){d()
var e=$(this).html()
$(this).removeClass("zeichenflaecheKlick"),bearbeitungAn=!0,v="zeichenflaeche",p=parseInt($(this).find("svg").attr("width")),u=parseInt($(this).find("svg").attr("height")),QreatorBezier.init(this,p,u,"#menu",!0),QreatorBezier.loadSVG(e)}),$(document).on("click",".markdownText",function(){d()
var e=$(this).find(".originaltext").text()
$(this).parent().attr("id","markdown"),bearbeitungAn=!0,v="markdown",Textabschnitt.init("#markdown","#menu",e)}),$(document).on("change","#fileInput",function(){var e=$("#fileInput")[0].files,t=e[0],n=new FileReader
n.onload=function(e){var t=e.target.result,n=document.createElement("div")
n.id="container",n.innerHTML=t,$("#content").html("<span><button class='einfuegen'>Einfügen</button><button class='einfuegenClipboard'>Einfügen Clipboard</button></span><button class='neueZeichenflaeche' >Neue Zeichenfläche</button><button class='pdf'>PDF einfügen</button><button class='markdownEinfuegen'>Neuer Textabschnitt</button><button class='bildEinfuegen'>Neues Bild</button>"),$(n).find(".tshareElement").each(function(){$(this).hasClass("zeichenflaeche")?($("#content").append("<div class='zeichenflaeche tshareElement zeichenflaecheKlick'>"+$(this).html()+"</div>"),$("#content").append(z)):$(this).hasClass("markdown")?($("#content").append("<div class='markdown tshareElement'>"+$(this).html()+"</div>"),$("#content").append(z)):$(this).hasClass("datei")&&($("#content").append("<div class='datei tshareElement'>"+$(this).html()+"</div>"),$("#content").append(z))}),$(".transparent").remove()},n.onerror=function(e){console.log(e.target.error.name)},n.onprogress=function(e){console.log(e.loaded,e.total)},n.readAsText(t)}),$(document).on("click","#laden",function(){$("body").append("<div class='transparent'></div>"),$(".transparent").append("<div class='fenster'><input id='fileInput' type='file' accept='text/html' required='required' ></input><button id='abbrechen'>Abbrechen</button><div id='parameter'></div></div>"),$("#fileInput").trigger("click")}),$(document).on("click","#bild",function(){$("body").append("<div class='transparent'></div>"),$(".transparent").append("<div class='fenster'><input id='imageInput' type='file' accept='image/*' required='required' ></input><button id='abbrechenBild'>Abbrechen</button><div id='parameter'></div></div>"),$("#imageInput").trigger("click")}),$(document).on("click","#abbrechen",function(){$(".transparent").remove(),$("#einsetzen").remove()}),$(document).on("click","#abbrechenBild",function(){QreatorBezier.loescheBild(),$(".transparent").remove()}),$(document).on("mousemove",".fenster .parameter",function(){var e=parseInt($("[typ='breite']").val()),t=parseInt($("[typ='hoehe']").val())
isNaN(e)&&(e=parseInt(100*k/p*t/100)),isNaN(t)&&(t=parseInt(100*w/u*e/100))
var n=parseInt($("[typ='x']").val()),a=parseInt($("[typ='y']").val())
$(".fenster #breite").html(""+e),$(".fenster #hoehe").html(""+t),$(".fenster #xpos").html(""+n),$(".fenster #ypos").html(""+a)}),$(document).on("change",".fenster .parameter",function(){var e=parseInt($("[typ='breite']").val()),t=parseInt($("[typ='hoehe']").val())
isNaN(e)&&(e=parseInt(100*k/p*t/100)),isNaN(t)&&(t=parseInt(100*w/u*e/100))
var n=parseInt($("[typ='x']").val()),a=parseInt($("[typ='y']").val())
QreatorBezier.ladeBild(g,parseInt(n*p/100),parseInt(a*u/100),parseInt(e*p/100),parseInt(t*u/100),!1)}),$(document).on("click","#bildEinfuegen",function(){var e=parseInt($("[typ='breite']").val()),t=parseInt($("[typ='hoehe']").val())
isNaN(e)&&(e=100*k/p*t/100),isNaN(t)&&(t=100*w/u*e/100)
var n=parseInt($("[typ='x']").val()),a=parseInt($("[typ='y']").val())
QreatorBezier.ladeBild(g,parseInt(n*p/100),parseInt(a*u/100),parseInt(e*p/100),parseInt(t*u/100),!0),$(".transparent").remove()}),$(document).on("click",".mittig",function(){var e=parseInt($("[typ='breite']").val()),t=parseInt($("[typ='hoehe']").val())
isNaN(e)&&(e=parseInt(100*k/p*t/100)),isNaN(t)&&(t=parseInt(100*w/u*e/100))
var n=parseInt($("[typ='x']").val()),a=parseInt($("[typ='y']").val()),i=$(this).attr("typ")
switch(i){case"xmitte":n=parseInt(50-e/2)
break
case"ymitte":a=parseInt(50-t/2)
break
case"links":n=0
break
case"rechts":n=100-e
break
case"oben":a=0
break
case"unten":a=100-t}$(".fenster #xpos").html(""+n),$("[typ='x']").val(n),$(".fenster #ypos").html(""+a),$("[typ='y']").val(a),QreatorBezier.ladeBild(g,parseInt(n*p/100),parseInt(a*u/100),parseInt(e*p/100),parseInt(t*u/100),!1)}),$(document).on("change","#imageInput",function(){var e=$("#imageInput")[0].files,t=e[0],n=new FileReader
n.onload=function(e){t.name.endsWith(".pdf")?(console.log("PDF"),PDFJS.disableWorker=!0,console.log(e.target.result),PDFJS.getDocument(e.target.result).then(function(e){e.getPage(1).then(function(e){var t=2.5,n=e.getViewport(t),a=document.createElement("canvas"),i=a.getContext("2d")
a.height=n.height,a.width=n.width
var r=e.render({canvasContext:i,viewport:n}),s=r._internalRenderTask.callback
r._internalRenderTask.callback=function(e){s.call(this,e)
for(var t={r:255,g:255,b:255},n=i.getImageData(0,0,a.width,a.height),r=0,o=n.data.length;o>r;r+=4){var l=n.data[r],d=n.data[r+1],c=n.data[r+2]
l==t.r&&d==t.g&&c==t.b&&(n.data[r+3]=0)}i.putImageData(n,0,0),g=new Image,g.onload=function(){k=a.width,w=a.height,y=!0,this.width>this.height&&(y=!1),1==y?(w=Math.min(u,this.height),u>w&&(w=u),k=this.width*w/this.height,k>p&&(w=w*p/k,k=p,y=!1)):(k=Math.min(p,this.width),p>k&&(k=p),w=this.height*k/this.width,w>u&&(k=k*u/w,w=u,y=!0)),console.log(g.src),0==y?$(".fenster #parameter").html("<br>Breite (in Prozent von Abschnittsbreite): <input typ='breite' class='parameter' type='range' min='0' max='100' value='"+parseInt(100*k/p)+"'></input><span id='breite'>"+parseInt(100*k/p)+"</span>%, Höhe:<span id='hoehe'>"+parseInt(100*w/u)+"</span>%"):$(".fenster #parameter").html("<br>Höhe (in Prozent von Abschnittshöhe): <input typ='hoehe' class='parameter' type='range' min='0' max='100' value='"+parseInt(100*w/u)+"'></input><span id='hoehe'>"+parseInt(100*w/u)+"</span>%, Breite: <span id='breite'>"+parseInt(100*k/p)+"</span>%"),$(".fenster #parameter").append("<br>x-Position links oben:  <input typ='x' class='parameter' type='range' min='0' max='100' value='0'></input><span id='xpos'>0</span><button class='mittig' typ='links'>linksbündig</button><button class='mittig' typ='xmitte'>horizontal zentrieren</button><button class='mittig' typ='rechts'>rechtsbündig</button>"),$(".fenster #parameter").append("<br>y-Position links oben:  <input typ='y' class='parameter' type='range' min='0' max='100' value='0'></input><span id='ypos'>0</span><button class='mittig' typ='oben'>oben bündig</button><button class='mittig' typ='ymitte'>vertikal zentrieren</button><button class='mittig' typ='unten'>unten bündig</button>"),$(".fenster #parameter").append("<br><button id='bildEinfuegen'>Bild einfügen</button>"),QreatorBezier.ladeBild(g,0,0,k,w,!1)},g.src=a.toDataURL()}})})):(g=new Image,g.onload=function(){k=0,w=0,y=!0,this.width>this.height&&(y=!1),1==y?(w=Math.min(u,this.height),u>w&&(w=u),k=this.width*w/this.height,k>p&&(w=w*p/k,k=p,y=!1)):(k=Math.min(p,this.width),p>k&&(k=p),w=this.height*k/this.width,w>u&&(k=k*u/w,w=u,y=!0)),0==y?$(".fenster #parameter").html("<br>Breite (in Prozent von Abschnittsbreite): <input typ='breite' class='parameter' type='range' min='0' max='100' value='"+parseInt(100*k/p)+"'></input><span id='breite'>"+parseInt(100*k/p)+"</span>%, Höhe:<span id='hoehe'>"+parseInt(100*w/u)+"</span>%"):$(".fenster #parameter").html("<br>Höhe (in Prozent von Abschnittshöhe): <input typ='hoehe' class='parameter' type='range' min='0' max='100' value='"+parseInt(100*w/u)+"'></input><span id='hoehe'>"+parseInt(100*w/u)+"</span>%, Breite: <span id='breite'>"+parseInt(100*k/p)+"</span>%"),$(".fenster #parameter").append("<br>x-Position links oben:  <input typ='x' class='parameter' type='range' min='0' max='100' value='0'></input><span id='xpos'>0</span><button class='mittig' typ='links'>linksbündig</button><button class='mittig' typ='xmitte'>horizontal zentrieren</button><button class='mittig' typ='rechts'>rechtsbündig</button>"),$(".fenster #parameter").append("<br>y-Position links oben:  <input typ='y' class='parameter' type='range' min='0' max='100' value='0'></input><span id='ypos'>0</span><button class='mittig' typ='oben'>oben bündig</button><button class='mittig' typ='ymitte'>vertikal zentrieren</button><button class='mittig' typ='unten'>unten bündig</button>"),$(".fenster #parameter").append("<br><button id='bildEinfuegen'>Bild einfügen</button>"),QreatorBezier.ladeBild(g,0,0,k,w,!1)},g.src=e.target.result)},n.onerror=function(e){console.log(e.target.error.name)},n.onprogress=function(e){console.log(e.loaded,e.total)},n.readAsDataURL(t)}),$(document).on("click",".loeschen",function(){var e=confirm("Sind Sie sicher, dass die gewählte Zeichenfläche inklusive Inhalt entfernt werden soll? Dieser Schritt kann nicht rückgängig gemacht werden!")
1==e&&(d(),$(this).parent().prev().remove(),$(this).parent().next().remove(),$(this).parent().next().remove(),$(this).parent().next().remove(),$(this).parent().next().remove(),$(this).parent().remove())})})
